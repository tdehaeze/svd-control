<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-02-17 mer. 15:15 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>Diagonal control using the SVD and the Jacobian Matrix</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Dehaeze Thomas" />
<link rel="stylesheet" type="text/css" href="https://research.tdehaeze.xyz/css/style.css"/>
<script type="text/javascript" src="https://research.tdehaeze.xyz/js/script.js"></script>
<script>
           MathJax = {
             svg: {
               scale: 1,
               fontCache: "global"
             },
             tex: {
               tags: "ams",
               multlineWidth: "%MULTLINEWIDTH",
               tagSide: "right",
                       macros: {bm: ["\\boldsymbol{#1}",1],},
               tagIndent: ".8em"
             }
           };
           </script>
           <script id="MathJax-script" async
             src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../index.html"> UP </a>
 |
 <a accesskey="H" href="../index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Diagonal control using the SVD and the Jacobian Matrix</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org46412fa">1. Gravimeter - Simscape Model</a>
<ul>
<li><a href="#orga42b2c4">1.1. Introduction</a></li>
<li><a href="#orgb9f3c49">1.2. Gravimeter Model - Parameters</a></li>
<li><a href="#orgba723b8">1.3. System Identification</a></li>
<li><a href="#org4637da8">1.4. Decoupling using the Jacobian</a></li>
<li><a href="#orgc201bbb">1.5. Decoupling using the SVD</a></li>
<li><a href="#orgc52974d">1.6. Verification of the decoupling using the &ldquo;Gershgorin Radii&rdquo;</a></li>
<li><a href="#orgadcf6dc">1.7. Verification of the decoupling using the &ldquo;Relative Gain Array&rdquo;</a></li>
<li><a href="#org16aa47f">1.8. Obtained Decoupled Plants</a></li>
<li><a href="#org15e43e1">1.9. Diagonal Controller</a></li>
<li><a href="#org22950ef">1.10. Closed-Loop system Performances</a></li>
<li><a href="#org04f0cbd">1.11. Robustness to a change of actuator position</a></li>
<li><a href="#org25f14c0">1.12. Choice of the reference frame for Jacobian decoupling</a>
<ul>
<li><a href="#orgc68d68d">1.12.1. Decoupling of the mass matrix</a></li>
<li><a href="#org47aa09c">1.12.2. Decoupling of the stiffness matrix</a></li>
<li><a href="#orgbd7a39a">1.12.3. Combined decoupling of the mass and stiffness matrices</a></li>
<li><a href="#orgcadeb64">1.12.4. Conclusion</a></li>
</ul>
</li>
<li><a href="#org5130d1c">1.13. SVD decoupling performances</a></li>
</ul>
</li>
<li><a href="#org985b94e">2. Parallel Manipulator with Collocated actuator/sensor pairs</a>
<ul>
<li><a href="#orgb9992cf">2.1. Model</a></li>
<li><a href="#orga79b2bf">2.2. The Jacobian Matrix</a></li>
<li><a href="#org1ad970b">2.3. The Stiffness Matrix</a></li>
<li><a href="#orga9522ed">2.4. Equations of motion - Frame of the legs</a></li>
<li><a href="#orgb74febb">2.5. Equations of motion - &ldquo;Center of mass&rdquo; {M}</a></li>
<li><a href="#org3c2d106">2.6. Equations of motion - &ldquo;Center of stiffness&rdquo; {K}</a></li>
<li><a href="#orgd1004c1">2.7. Conclusion</a></li>
</ul>
</li>
<li><a href="#org3a64a45">3. Diagonal Stiffness Matrix for a planar manipulator</a>
<ul>
<li><a href="#orgdd8ae63">3.1. Model and Assumptions</a></li>
<li><a href="#org57315a0">3.2. Objective</a></li>
<li><a href="#orgf65bc66">3.3. Conditions for Diagonal Stiffness</a></li>
<li><a href="#org06a2a28">3.4. Example 1 - Planar manipulator with 3 actuators</a></li>
<li><a href="#orge3c3696">3.5. Example 2 - Planar manipulator with 4 actuators</a></li>
</ul>
</li>
<li><a href="#orgbc3eaba">4. Diagonal Stiffness Matrix for a general parallel manipulator</a>
<ul>
<li><a href="#org76d5003">4.1. Model and Assumptions</a></li>
<li><a href="#org3c8d37f">4.2. Objective</a></li>
<li><a href="#org30aace6">4.3. Analytical formula of the stiffness matrix</a></li>
<li><a href="#orgf60e332">4.4. Example 1 - 6DoF manipulator (3D)</a></li>
<li><a href="#orgf6345a4">4.5. Example 2 - Stewart Platform</a></li>
</ul>
</li>
<li><a href="#org1c48f2d">5. Stiffness and Mass Matrices in the Leg&rsquo;s frame</a>
<ul>
<li><a href="#org876badc">5.1. Equations</a></li>
<li><a href="#orgc2a4b8d">5.2. Stiffness matrix</a></li>
<li><a href="#org103d033">5.3. Mass matrix</a></li>
<li><a href="#orgbc3dbc5">5.4. Planar Example</a></li>
</ul>
</li>
<li><a href="#org2a7399f">6. Stewart Platform - Simscape Model</a>
<ul>
<li><a href="#orga3861da">6.1. Simscape Model - Parameters</a></li>
<li><a href="#orgc4e5701">6.2. Identification of the plant</a></li>
<li><a href="#org4a98b83">6.3. Decoupling using the Jacobian</a></li>
<li><a href="#org05f169b">6.4. Decoupling using the SVD</a></li>
<li><a href="#org1cbd2c1">6.5. Verification of the decoupling using the &ldquo;Gershgorin Radii&rdquo;</a></li>
<li><a href="#org18efe55">6.6. Verification of the decoupling using the &ldquo;Relative Gain Array&rdquo;</a></li>
<li><a href="#orgadea7b0">6.7. Obtained Decoupled Plants</a></li>
<li><a href="#orgc208a81">6.8. Diagonal Controller</a></li>
<li><a href="#org0759f51">6.9. Closed-Loop system Performances</a></li>
</ul>
</li>
</ul>
</div>
</div>
<hr>
<p>This report is also available as a <a href="./index.pdf">pdf</a>.</p>
<hr>

<p>
In this document, the use of the Jacobian matrix and the Singular Value Decomposition to render a physical plant diagonal dominant is studied.
Then, a diagonal controller is used.
</p>

<p>
These two methods are tested on two plants:
</p>
<ul class="org-ul">
<li>In Section <a href="#org3ffab30">1</a> on a 3-DoF gravimeter</li>
<li>In Section <a href="#org739fa10">6</a> on a 6-DoF Stewart platform</li>
</ul>

<div id="outline-container-org46412fa" class="outline-2">
<h2 id="org46412fa"><span class="section-number-2">1</span> Gravimeter - Simscape Model</h2>
<div class="outline-text-2" id="text-1">
<p>
<a id="org3ffab30"></a>
</p>
</div>

<div id="outline-container-orga42b2c4" class="outline-3">
<h3 id="orga42b2c4"><span class="section-number-3">1.1</span> Introduction</h3>
<div class="outline-text-3" id="text-1-1">
<p>
In this part, diagonal control using both the SVD and the Jacobian matrices are applied on a gravimeter model:
</p>
<ul class="org-ul">
<li>Section <a href="#org6e65fbe">1.2</a>: the model is described and its parameters are defined.</li>
<li>Section <a href="#orgc3182ae">1.3</a>: the plant dynamics from the actuators to the sensors is computed from a Simscape model.</li>
<li>Section <a href="#orgffaed3a">1.4</a>: the plant is decoupled using the Jacobian matrices.</li>
<li>Section <a href="#orgaadc493">1.5</a>: the Singular Value Decomposition is performed on a real approximation of the plant transfer matrix and further use to decouple the system.</li>
<li>Section <a href="#org611e67e">1.6</a>: the effectiveness of the decoupling is computed using the Gershorin radii</li>
<li>Section <a href="#org31e39e5">1.7</a>: the effectiveness of the decoupling is computed using the Relative Gain Array</li>
<li>Section <a href="#org560991e">1.8</a>: the obtained decoupled plants are compared</li>
<li>Section <a href="#org65f3f42">1.9</a>: the diagonal controller is developed</li>
<li>Section <a href="#org94cb0e3">1.10</a>: the obtained closed-loop performances for the two methods are compared</li>
<li>Section <a href="#orge4ed60d">1.11</a>: the robustness to a change of actuator position is evaluated</li>
<li>Section <a href="#orgf390b7c">1.12</a>: the choice of the reference frame for the evaluation of the Jacobian is discussed</li>
<li>Section <a href="#orgb78f794">1.13</a>: the decoupling performances of SVD is evaluated for a low damped and an highly damped system</li>
</ul>
</div>
</div>

<div id="outline-container-orgb9f3c49" class="outline-3">
<h3 id="orgb9f3c49"><span class="section-number-3">1.2</span> Gravimeter Model - Parameters</h3>
<div class="outline-text-3" id="text-1-2">
<p>
<a id="org6e65fbe"></a>
</p>

<p>
The model of the gravimeter is schematically shown in Figure <a href="#org78d0d53">1</a>.
</p>


<div id="org78d0d53" class="figure">
<p><img src="figs/gravimeter_model.png" alt="gravimeter_model.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Model of the gravimeter</p>
</div>


<div id="org011121a" class="figure">
<p><img src="figs/leg_model.png" alt="leg_model.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Model of the struts</p>
</div>

<p>
The parameters used for the simulation are the following:
</p>
<div class="org-src-container">
<pre class="src src-matlab">l  = 1.0; <span class="org-comment">% Length of the mass [m]</span>
h  = 1.7; <span class="org-comment">% Height of the mass [m]</span>

la = l<span class="org-type">/</span>2; <span class="org-comment">% Position of Act. [m]</span>
ha = h<span class="org-type">/</span>2; <span class="org-comment">% Position of Act. [m]</span>

m = 400; <span class="org-comment">% Mass [kg]</span>
I = 115; <span class="org-comment">% Inertia [kg m^2]</span>

k = 15e3; <span class="org-comment">% Actuator Stiffness [N/m]</span>
c = 2e1; <span class="org-comment">% Actuator Damping [N/(m/s)]</span>

deq = 0.2; <span class="org-comment">% Length of the actuators [m]</span>

g = 0; <span class="org-comment">% Gravity [m/s2]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba723b8" class="outline-3">
<h3 id="orgba723b8"><span class="section-number-3">1.3</span> System Identification</h3>
<div class="outline-text-3" id="text-1-3">
<p>
<a id="orgc3182ae"></a>
</p>

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Name of the Simulink File</span></span>
mdl = <span class="org-string">'gravimeter'</span>;

<span class="org-matlab-cellbreak"><span class="org-comment">%% Input/Output definition</span></span>
clear io; io_i = 1;
io(io_i) = linio([mdl, <span class="org-string">'/F1'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F2'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F3'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_side'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_side'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_top'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_top'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;

G = linearize(mdl, io);
G.InputName  = {<span class="org-string">'F1'</span>, <span class="org-string">'F2'</span>, <span class="org-string">'F3'</span>};
G.OutputName = {<span class="org-string">'Ax1'</span>, <span class="org-string">'Ay1'</span>, <span class="org-string">'Ax2'</span>, <span class="org-string">'Ay2'</span>};
</pre>
</div>

<p>
The inputs and outputs of the plant are shown in Figure <a href="#orge86658f">3</a>.
</p>

<p>
More precisely there are three inputs (the three actuator forces):
</p>
\begin{equation}
  \bm{\tau} = \begin{bmatrix}\tau_1 \\ \tau_2 \\ \tau_2 \end{bmatrix}
\end{equation}
<p>
And 4 outputs (the two 2-DoF accelerometers):
</p>
\begin{equation}
  \bm{a} = \begin{bmatrix} a_{1x} \\ a_{1y} \\ a_{2x} \\ a_{2y} \end{bmatrix}
\end{equation}


<div id="orge86658f" class="figure">
<p><img src="figs/gravimeter_plant_schematic.png" alt="gravimeter_plant_schematic.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Schematic of the gravimeter plant</p>
</div>

<p>
We can check the poles of the plant:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">-0.12243+13.551i</td>
</tr>

<tr>
<td class="org-left">-0.12243-13.551i</td>
</tr>

<tr>
<td class="org-left">-0.05+8.6601i</td>
</tr>

<tr>
<td class="org-left">-0.05-8.6601i</td>
</tr>

<tr>
<td class="org-left">-0.0088785+3.6493i</td>
</tr>

<tr>
<td class="org-left">-0.0088785-3.6493i</td>
</tr>
</tbody>
</table>

<p>
As expected, the plant as 6 states (2 translations + 1 rotation)
</p>
<div class="org-src-container">
<pre class="src src-matlab">size(G)
</pre>
</div>

<pre class="example">
State-space model with 4 outputs, 3 inputs, and 6 states.
</pre>


<p>
The bode plot of all elements of the plant are shown in Figure <a href="#orgdc2f40e">4</a>.
</p>


<div id="orgdc2f40e" class="figure">
<p><img src="figs/open_loop_tf.png" alt="open_loop_tf.png" />
</p>
<p><span class="figure-number">Figure 4: </span>Open Loop Transfer Function from 3 Actuators to 4 Accelerometers</p>
</div>
</div>
</div>

<div id="outline-container-org4637da8" class="outline-3">
<h3 id="org4637da8"><span class="section-number-3">1.4</span> Decoupling using the Jacobian</h3>
<div class="outline-text-3" id="text-1-4">
<p>
<a id="orgffaed3a"></a>
</p>

<p>
Consider the control architecture shown in Figure <a href="#org01e583d">5</a>.
</p>

<p>
The Jacobian matrix \(J_{\tau}\) is used to transform forces applied by the three actuators into forces/torques applied on the gravimeter at its center of mass:
</p>
\begin{equation}
  \begin{bmatrix} \tau_1 \\ \tau_2 \\ \tau_3 \end{bmatrix} = J_{\tau}^{-T} \begin{bmatrix} F_x \\ F_y \\ M_z \end{bmatrix}
\end{equation}

<p>
The Jacobian matrix \(J_{a}\) is used to compute the vertical acceleration, horizontal acceleration and rotational acceleration of the mass with respect to its center of mass:
</p>
\begin{equation}
  \begin{bmatrix} a_x \\ a_y \\ a_{R_z} \end{bmatrix} = J_{a}^{-1} \begin{bmatrix} a_{x1} \\ a_{y1} \\ a_{x2} \\ a_{y2} \end{bmatrix}
\end{equation}

<p>
We thus define a new plant as defined in Figure <a href="#org01e583d">5</a>.
\[ \bm{G}_x(s) = J_a^{-1} \bm{G}(s) J_{\tau}^{-T} \]
</p>

<p>
\(\bm{G}_x(s)\) correspond to the \(3 \times 3\) transfer function matrix from forces and torques applied to the gravimeter at its center of mass to the absolute acceleration of the gravimeter&rsquo;s center of mass (Figure <a href="#org01e583d">5</a>).
</p>


<div id="org01e583d" class="figure">
<p><img src="figs/gravimeter_decouple_jacobian.png" alt="gravimeter_decouple_jacobian.png" />
</p>
<p><span class="figure-number">Figure 5: </span>Decoupled plant \(\bm{G}_x\) using the Jacobian matrix \(J\)</p>
</div>

<p>
The Jacobian corresponding to the sensors and actuators are defined below:
</p>
<div class="org-src-container">
<pre class="src src-matlab">Ja = [1 0 <span class="org-type">-</span>h<span class="org-type">/</span>2
      0 1  l<span class="org-type">/</span>2
      1 0  h<span class="org-type">/</span>2
      0 1  0];

Jt = [1 0 <span class="org-type">-</span>ha
      0 1  la
      0 1 <span class="org-type">-</span>la];
</pre>
</div>

<p>
And the plant \(\bm{G}_x\) is computed:
</p>
<div class="org-src-container">
<pre class="src src-matlab">Gx = pinv(Ja)<span class="org-type">*</span>G<span class="org-type">*</span>pinv(Jt<span class="org-type">'</span>);
Gx.InputName  = {<span class="org-string">'Fx'</span>, <span class="org-string">'Fy'</span>, <span class="org-string">'Mz'</span>};
Gx.OutputName  = {<span class="org-string">'Dx'</span>, <span class="org-string">'Dy'</span>, <span class="org-string">'Rz'</span>};
</pre>
</div>

<pre class="example">
size(Gx)
State-space model with 3 outputs, 3 inputs, and 6 states.
</pre>


<p>
The diagonal and off-diagonal elements of \(G_x\) are shown in Figure <a href="#org8d38190">6</a>.
</p>

<p>
It is shown at the system is:
</p>
<ul class="org-ul">
<li>decoupled at high frequency thanks to a diagonal mass matrix (the Jacobian being evaluated at the center of mass of the payload)</li>
<li>coupled at low frequency due to the non-diagonal terms in the stiffness matrix, especially the term corresponding to a coupling between a force in the x direction to a rotation around z (due to the torque applied by the stiffness 1).</li>
</ul>

<p>
The choice of the frame in this the Jacobian is evaluated is discussed in Section <a href="#orgf390b7c">1.12</a>.
</p>


<div id="org8d38190" class="figure">
<p><img src="figs/gravimeter_jacobian_plant.png" alt="gravimeter_jacobian_plant.png" />
</p>
<p><span class="figure-number">Figure 6: </span>Diagonal and off-diagonal elements of \(G_x\)</p>
</div>
</div>
</div>

<div id="outline-container-orgc201bbb" class="outline-3">
<h3 id="orgc201bbb"><span class="section-number-3">1.5</span> Decoupling using the SVD</h3>
<div class="outline-text-3" id="text-1-5">
<p>
<a id="orgaadc493"></a>
</p>

<p>
In order to decouple the plant using the SVD, first a real approximation of the plant transfer function matrix as the crossover frequency is required.
</p>

<p>
Let&rsquo;s compute a real approximation of the complex matrix \(H_1\) which corresponds to the the transfer function \(G(j\omega_c)\) from forces applied by the actuators to the measured acceleration of the top platform evaluated at the frequency \(\omega_c\).
</p>
<div class="org-src-container">
<pre class="src src-matlab">wc = 2<span class="org-type">*</span><span class="org-constant">pi</span><span class="org-type">*</span>10; <span class="org-comment">% Decoupling frequency [rad/s]</span>

H1 = evalfr(G, <span class="org-constant">j</span><span class="org-type">*</span>wc);
</pre>
</div>

<p>
The real approximation is computed as follows:
</p>
<div class="org-src-container">
<pre class="src src-matlab">D = pinv(real(H1<span class="org-type">'*</span>H1));
H1 = pinv(D<span class="org-type">*</span>real(H1<span class="org-type">'*</span>diag(exp(<span class="org-constant">j</span><span class="org-type">*</span>angle(diag(H1<span class="org-type">*</span>D<span class="org-type">*</span>H1<span class="org-type">.'</span>))<span class="org-type">/</span>2))));
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> Real approximate of \(G\) at the decoupling frequency \(\omega_c\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0.0092</td>
<td class="org-right">-0.0039</td>
<td class="org-right">0.0039</td>
</tr>

<tr>
<td class="org-right">-0.0039</td>
<td class="org-right">0.0048</td>
<td class="org-right">0.00028</td>
</tr>

<tr>
<td class="org-right">-0.004</td>
<td class="org-right">0.0038</td>
<td class="org-right">-0.0038</td>
</tr>

<tr>
<td class="org-right">8.4e-09</td>
<td class="org-right">0.0025</td>
<td class="org-right">0.0025</td>
</tr>
</tbody>
</table>


<p>
Now, the Singular Value Decomposition of \(H_1\) is performed:
\[ H_1 = U \Sigma V^H \]
</p>

<div class="org-src-container">
<pre class="src src-matlab">[U,S,V] = svd(H1);
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 2:</span> \(U\) matrix</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">-0.78</td>
<td class="org-right">0.26</td>
<td class="org-right">-0.53</td>
<td class="org-right">-0.2</td>
</tr>

<tr>
<td class="org-right">0.4</td>
<td class="org-right">0.61</td>
<td class="org-right">-0.04</td>
<td class="org-right">-0.68</td>
</tr>

<tr>
<td class="org-right">0.48</td>
<td class="org-right">-0.14</td>
<td class="org-right">-0.85</td>
<td class="org-right">0.2</td>
</tr>

<tr>
<td class="org-right">0.03</td>
<td class="org-right">0.73</td>
<td class="org-right">0.06</td>
<td class="org-right">0.68</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 3:</span> \(V\) matrix</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">-0.79</td>
<td class="org-right">0.11</td>
<td class="org-right">-0.6</td>
</tr>

<tr>
<td class="org-right">0.51</td>
<td class="org-right">0.67</td>
<td class="org-right">-0.54</td>
</tr>

<tr>
<td class="org-right">-0.35</td>
<td class="org-right">0.73</td>
<td class="org-right">0.59</td>
</tr>
</tbody>
</table>

<p>
The obtained matrices \(U\) and \(V\) are used to decouple the system as shown in Figure <a href="#org67d210c">7</a>.
</p>


<div id="org67d210c" class="figure">
<p><img src="figs/gravimeter_decouple_svd.png" alt="gravimeter_decouple_svd.png" />
</p>
<p><span class="figure-number">Figure 7: </span>Decoupled plant \(\bm{G}_{SVD}\) using the Singular Value Decomposition</p>
</div>

<p>
The decoupled plant is then:
\[ \bm{G}_{SVD}(s) = U^{-1} \bm{G}(s) V^{-H} \]
</p>

<div class="org-src-container">
<pre class="src src-matlab">Gsvd = inv(U)<span class="org-type">*</span>G<span class="org-type">*</span>inv(V<span class="org-type">'</span>);
</pre>
</div>

<pre class="example">
size(Gsvd)
State-space model with 4 outputs, 3 inputs, and 6 states.
</pre>


<p>
The 4th output (corresponding to the null singular value) is discarded, and we only keep the \(3 \times 3\) plant:
</p>
<div class="org-src-container">
<pre class="src src-matlab">Gsvd = Gsvd(1<span class="org-type">:</span>3, 1<span class="org-type">:</span>3);
</pre>
</div>

<p>
The diagonal and off-diagonal elements of the &ldquo;SVD&rdquo; plant are shown in Figure <a href="#orgb30554e">8</a>.
</p>

<div id="orgb30554e" class="figure">
<p><img src="figs/gravimeter_svd_plant.png" alt="gravimeter_svd_plant.png" />
</p>
<p><span class="figure-number">Figure 8: </span>Diagonal and off-diagonal elements of \(G_{svd}\)</p>
</div>
</div>
</div>

<div id="outline-container-orgc52974d" class="outline-3">
<h3 id="orgc52974d"><span class="section-number-3">1.6</span> Verification of the decoupling using the &ldquo;Gershgorin Radii&rdquo;</h3>
<div class="outline-text-3" id="text-1-6">
<p>
<a id="org611e67e"></a>
</p>

<p>
The &ldquo;Gershgorin Radii&rdquo; is computed for the coupled plant \(G(s)\), for the &ldquo;Jacobian plant&rdquo; \(G_x(s)\) and the &ldquo;SVD Decoupled Plant&rdquo; \(G_{SVD}(s)\):
</p>

<p>
The &ldquo;Gershgorin Radii&rdquo; of a matrix \(S\) is defined by:
\[ \zeta_i(j\omega) = \frac{\sum\limits_{j\neq i}|S_{ij}(j\omega)|}{|S_{ii}(j\omega)|} \]
</p>


<div id="org54b8c7f" class="figure">
<p><img src="figs/gravimeter_gershgorin_radii.png" alt="gravimeter_gershgorin_radii.png" />
</p>
<p><span class="figure-number">Figure 9: </span>Gershgorin Radii of the Coupled and Decoupled plants</p>
</div>
</div>
</div>

<div id="outline-container-orgadcf6dc" class="outline-3">
<h3 id="orgadcf6dc"><span class="section-number-3">1.7</span> Verification of the decoupling using the &ldquo;Relative Gain Array&rdquo;</h3>
<div class="outline-text-3" id="text-1-7">
<p>
<a id="org31e39e5"></a>
</p>

<p>
The relative gain array (RGA) is defined as:
</p>
\begin{equation}
  \Lambda\big(G(s)\big) = G(s) \times \big( G(s)^{-1} \big)^T
\end{equation}
<p>
where \(\times\) denotes an element by element multiplication and \(G(s)\) is an \(n \times n\) square transfer matrix.
</p>

<p>
The obtained RGA elements are shown in Figure <a href="#orgd076b11">10</a>.
</p>


<div id="orgd076b11" class="figure">
<p><img src="figs/gravimeter_rga.png" alt="gravimeter_rga.png" />
</p>
<p><span class="figure-number">Figure 10: </span>Obtained norm of RGA elements for the SVD decoupled plant and the Jacobian decoupled plant</p>
</div>

<p>
The RGA-number is also a measure of diagonal dominance:
</p>
\begin{equation}
  \text{RGA-number} = \| \Lambda(G) - I \|_\text{sum}
\end{equation}


<div id="org5da9647" class="figure">
<p><img src="figs/gravimeter_rga_num.png" alt="gravimeter_rga_num.png" />
</p>
<p><span class="figure-number">Figure 11: </span>RGA-Number for the Gravimeter</p>
</div>
</div>
</div>

<div id="outline-container-org16aa47f" class="outline-3">
<h3 id="org16aa47f"><span class="section-number-3">1.8</span> Obtained Decoupled Plants</h3>
<div class="outline-text-3" id="text-1-8">
<p>
<a id="org560991e"></a>
</p>

<p>
The bode plot of the diagonal and off-diagonal elements of \(G_{SVD}\) are shown in Figure <a href="#org50a6941">12</a>.
</p>


<div id="org50a6941" class="figure">
<p><img src="figs/gravimeter_decoupled_plant_svd.png" alt="gravimeter_decoupled_plant_svd.png" />
</p>
<p><span class="figure-number">Figure 12: </span>Decoupled Plant using SVD</p>
</div>

<p>
Similarly, the bode plots of the diagonal elements and off-diagonal elements of the decoupled plant \(G_x(s)\) using the Jacobian are shown in Figure <a href="#org91f4241">13</a>.
</p>


<div id="org91f4241" class="figure">
<p><img src="figs/gravimeter_decoupled_plant_jacobian.png" alt="gravimeter_decoupled_plant_jacobian.png" />
</p>
<p><span class="figure-number">Figure 13: </span>Gravimeter Platform Plant from forces (resp. torques) applied by the legs to the acceleration (resp. angular acceleration) of the platform as well as all the coupling terms between the two (non-diagonal terms of the transfer function matrix)</p>
</div>
</div>
</div>

<div id="outline-container-org15e43e1" class="outline-3">
<h3 id="org15e43e1"><span class="section-number-3">1.9</span> Diagonal Controller</h3>
<div class="outline-text-3" id="text-1-9">
<p>
<a id="org65f3f42"></a>
The control diagram for the centralized control is shown in Figure <a href="#org2b8479e">14</a>.
</p>

<p>
The controller \(K_c\) is &ldquo;working&rdquo; in an cartesian frame.
The Jacobian is used to convert forces in the cartesian frame to forces applied by the actuators.
</p>


<div id="org2b8479e" class="figure">
<p><img src="figs/centralized_control_gravimeter.png" alt="centralized_control_gravimeter.png" />
</p>
<p><span class="figure-number">Figure 14: </span>Control Diagram for the Centralized control</p>
</div>

<p>
The SVD control architecture is shown in Figure <a href="#org8375a7c">15</a>.
The matrices \(U\) and \(V\) are used to decoupled the plant \(G\).
</p>


<div id="org8375a7c" class="figure">
<p><img src="figs/svd_control_gravimeter.png" alt="svd_control_gravimeter.png" />
</p>
<p><span class="figure-number">Figure 15: </span>Control Diagram for the SVD control</p>
</div>


<p>
We choose the controller to be a low pass filter:
\[ K_c(s) = \frac{G_0}{1 + \frac{s}{\omega_0}} \]
</p>

<p>
\(G_0\) is tuned such that the crossover frequency corresponding to the diagonal terms of the loop gain is equal to \(\omega_c\)
</p>

<div class="org-src-container">
<pre class="src src-matlab">wc = 2<span class="org-type">*</span><span class="org-constant">pi</span><span class="org-type">*</span>10;  <span class="org-comment">% Crossover Frequency [rad/s]</span>
w0 = 2<span class="org-type">*</span><span class="org-constant">pi</span><span class="org-type">*</span>0.1; <span class="org-comment">% Controller Pole [rad/s]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">K_cen = diag(1<span class="org-type">./</span>diag(abs(evalfr(Gx, <span class="org-constant">j</span><span class="org-type">*</span>wc))))<span class="org-type">*</span>(1<span class="org-type">/</span>abs(evalfr(1<span class="org-type">/</span>(1 <span class="org-type">+</span> s<span class="org-type">/</span>w0), <span class="org-constant">j</span><span class="org-type">*</span>wc)))<span class="org-type">/</span>(1 <span class="org-type">+</span> s<span class="org-type">/</span>w0);
L_cen = K_cen<span class="org-type">*</span>Gx;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">K_svd = diag(1<span class="org-type">./</span>diag(abs(evalfr(Gsvd, <span class="org-constant">j</span><span class="org-type">*</span>wc))))<span class="org-type">*</span>(1<span class="org-type">/</span>abs(evalfr(1<span class="org-type">/</span>(1 <span class="org-type">+</span> s<span class="org-type">/</span>w0), <span class="org-constant">j</span><span class="org-type">*</span>wc)))<span class="org-type">/</span>(1 <span class="org-type">+</span> s<span class="org-type">/</span>w0);
L_svd = K_svd<span class="org-type">*</span>Gsvd;
U_inv = inv(U);
</pre>
</div>

<p>
The obtained diagonal elements of the loop gains are shown in Figure <a href="#org023854c">16</a>.
</p>


<div id="org023854c" class="figure">
<p><img src="figs/gravimeter_comp_loop_gain_diagonal.png" alt="gravimeter_comp_loop_gain_diagonal.png" />
</p>
<p><span class="figure-number">Figure 16: </span>Comparison of the diagonal elements of the loop gains for the SVD control architecture and the Jacobian one</p>
</div>
</div>
</div>

<div id="outline-container-org22950ef" class="outline-3">
<h3 id="org22950ef"><span class="section-number-3">1.10</span> Closed-Loop system Performances</h3>
<div class="outline-text-3" id="text-1-10">
<p>
<a id="org94cb0e3"></a>
</p>

<p>
Now the system is identified again with additional inputs and outputs:
</p>
<ul class="org-ul">
<li>\(x\), \(y\) and \(R_z\) ground motion</li>
<li>\(x\), \(y\) and \(R_z\) acceleration of the payload.</li>
</ul>

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Name of the Simulink File</span></span>
mdl = <span class="org-string">'gravimeter'</span>;

<span class="org-matlab-cellbreak"><span class="org-comment">%% Input/Output definition</span></span>
clear io; io_i = 1;
io(io_i) = linio([mdl, <span class="org-string">'/Dx'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Dy'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Rz'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F1'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F2'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F3'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Abs_Motion'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Abs_Motion'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Abs_Motion'</span>], 3, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_side'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_side'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_top'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_top'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;

G = linearize(mdl, io);
G.InputName  = {<span class="org-string">'Dx'</span>, <span class="org-string">'Dy'</span>, <span class="org-string">'Rz'</span>, <span class="org-string">'F1'</span>, <span class="org-string">'F2'</span>, <span class="org-string">'F3'</span>};
G.OutputName = {<span class="org-string">'Ax'</span>, <span class="org-string">'Ay'</span>, <span class="org-string">'Arz'</span>, <span class="org-string">'Ax1'</span>, <span class="org-string">'Ay1'</span>, <span class="org-string">'Ax2'</span>, <span class="org-string">'Ay2'</span>};
</pre>
</div>

<p>
The loop is closed using the developed controllers.
</p>
<div class="org-src-container">
<pre class="src src-matlab">G_cen = lft(G, <span class="org-type">-</span>pinv(Jt<span class="org-type">'</span>)<span class="org-type">*</span>K_cen<span class="org-type">*</span>pinv(Ja));
G_svd = lft(G, <span class="org-type">-</span>inv(V<span class="org-type">'</span>)<span class="org-type">*</span>K_svd<span class="org-type">*</span>U_inv(1<span class="org-type">:</span>3, <span class="org-type">:</span>));
</pre>
</div>

<p>
Let&rsquo;s first verify the stability of the closed-loop systems:
</p>
<div class="org-src-container">
<pre class="src src-matlab">isstable(G_cen)
</pre>
</div>

<pre class="example">
ans =
  logical
   1
</pre>


<div class="org-src-container">
<pre class="src src-matlab">isstable(G_svd)
</pre>
</div>

<pre class="example">
ans =
  logical
   1
</pre>


<p>
The obtained transmissibility in Open-loop, for the centralized control as well as for the SVD control are shown in Figure <a href="#orgf2f7c12">17</a>.
</p>


<div id="orgf2f7c12" class="figure">
<p><img src="figs/gravimeter_platform_simscape_cl_transmissibility.png" alt="gravimeter_platform_simscape_cl_transmissibility.png" />
</p>
<p><span class="figure-number">Figure 17: </span>Obtained Transmissibility</p>
</div>


<div id="org2a23fb7" class="figure">
<p><img src="figs/gravimeter_cl_transmissibility_coupling.png" alt="gravimeter_cl_transmissibility_coupling.png" />
</p>
<p><span class="figure-number">Figure 18: </span>Obtain coupling terms of the transmissibility matrix</p>
</div>
</div>
</div>


<div id="outline-container-org04f0cbd" class="outline-3">
<h3 id="org04f0cbd"><span class="section-number-3">1.11</span> Robustness to a change of actuator position</h3>
<div class="outline-text-3" id="text-1-11">
<p>
<a id="orge4ed60d"></a>
</p>

<p>
Let say we change the position of the actuators:
</p>
<div class="org-src-container">
<pre class="src src-matlab">la = l<span class="org-type">/</span>2<span class="org-type">*</span>0.7; <span class="org-comment">% Position of Act. [m]</span>
ha = h<span class="org-type">/</span>2<span class="org-type">*</span>0.7; <span class="org-comment">% Position of Act. [m]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Name of the Simulink File</span></span>
mdl = <span class="org-string">'gravimeter'</span>;

<span class="org-matlab-cellbreak"><span class="org-comment">%% Input/Output definition</span></span>
clear io; io_i = 1;
io(io_i) = linio([mdl, <span class="org-string">'/Dx'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Dy'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Rz'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F1'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F2'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F3'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Abs_Motion'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Abs_Motion'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Abs_Motion'</span>], 3, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_side'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_side'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_top'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_top'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;

G = linearize(mdl, io);
G.InputName  = {<span class="org-string">'Dx'</span>, <span class="org-string">'Dy'</span>, <span class="org-string">'Rz'</span>, <span class="org-string">'F1'</span>, <span class="org-string">'F2'</span>, <span class="org-string">'F3'</span>};
G.OutputName = {<span class="org-string">'Ax'</span>, <span class="org-string">'Ay'</span>, <span class="org-string">'Arz'</span>, <span class="org-string">'Ax1'</span>, <span class="org-string">'Ay1'</span>, <span class="org-string">'Ax2'</span>, <span class="org-string">'Ay2'</span>};
</pre>
</div>

<p>
The loop is closed using the developed controllers.
</p>
<div class="org-src-container">
<pre class="src src-matlab">G_cen_b = lft(G, <span class="org-type">-</span>pinv(Jt<span class="org-type">'</span>)<span class="org-type">*</span>K_cen<span class="org-type">*</span>pinv(Ja));
G_svd_b = lft(G, <span class="org-type">-</span>inv(V<span class="org-type">'</span>)<span class="org-type">*</span>K_svd<span class="org-type">*</span>U_inv(1<span class="org-type">:</span>3, <span class="org-type">:</span>));
</pre>
</div>

<p>
The new plant is computed, and the centralized and SVD control architectures are applied using the previously computed Jacobian matrices and \(U\) and \(V\) matrices.
</p>

<p>
The closed-loop system are still stable in both cases, and the obtained transmissibility are equivalent as shown in Figure <a href="#org8c0f89c">19</a>.
</p>


<div id="org8c0f89c" class="figure">
<p><img src="figs/gravimeter_transmissibility_offset_act.png" alt="gravimeter_transmissibility_offset_act.png" />
</p>
<p><span class="figure-number">Figure 19: </span>Transmissibility for the initial CL system and when the position of  actuators are changed</p>
</div>
</div>
</div>

<div id="outline-container-org25f14c0" class="outline-3">
<h3 id="org25f14c0"><span class="section-number-3">1.12</span> Choice of the reference frame for Jacobian decoupling</h3>
<div class="outline-text-3" id="text-1-12">
<p>
<a id="orgf390b7c"></a>
</p>
<p>
If we want to decouple the system at low frequency (determined by the stiffness matrix), we have to compute the Jacobian at a point where the stiffness matrix is diagonal.
A displacement (resp. rotation) of the mass at this particular point should induce a <b>pure</b> force (resp. torque) on the same point due to stiffnesses in the system.
This can be verified by geometrical computations.
</p>


<p>
If we want to decouple the system at high frequency (determined by the mass matrix), we have tot compute the Jacobians at the Center of Mass of the suspended solid.
Similarly to the stiffness analysis, when considering only the inertia effects (neglecting the stiffnesses), a force (resp. torque) applied at this point (the center of mass) should induce a <b>pure</b> acceleration (resp. angular acceleration).
</p>


<p>
Ideally, we would like to have a decoupled mass matrix and stiffness matrix at the same time.
To do so, the actuators (springs) should be positioned such that the stiffness matrix is diagonal when evaluated at the CoM of the solid.
</p>
</div>
<div id="outline-container-orgc68d68d" class="outline-4">
<h4 id="orgc68d68d"><span class="section-number-4">1.12.1</span> Decoupling of the mass matrix</h4>
<div class="outline-text-4" id="text-1-12-1">

<div id="org0c0bbd1" class="figure">
<p><img src="figs/gravimeter_model_M.png" alt="gravimeter_model_M.png" />
</p>
<p><span class="figure-number">Figure 20: </span>Choice of {O} such that the Mass Matrix is Diagonal</p>
</div>

<div class="org-src-container">
<pre class="src src-matlab">la = l<span class="org-type">/</span>2; <span class="org-comment">% Position of Act. [m]</span>
ha = h<span class="org-type">/</span>2; <span class="org-comment">% Position of Act. [m]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Name of the Simulink File</span></span>
mdl = <span class="org-string">'gravimeter'</span>;

<span class="org-matlab-cellbreak"><span class="org-comment">%% Input/Output definition</span></span>
clear io; io_i = 1;
io(io_i) = linio([mdl, <span class="org-string">'/F1'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F2'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F3'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_side'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_side'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_top'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_top'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;

G = linearize(mdl, io);
G.InputName  = {<span class="org-string">'F1'</span>, <span class="org-string">'F2'</span>, <span class="org-string">'F3'</span>};
G.OutputName = {<span class="org-string">'Ax1'</span>, <span class="org-string">'Ay1'</span>, <span class="org-string">'Ax2'</span>, <span class="org-string">'Ay2'</span>};
</pre>
</div>

<p>
Decoupling at the CoM (Mass decoupled)
</p>
<div class="org-src-container">
<pre class="src src-matlab">JMa = [1 0 <span class="org-type">-</span>h<span class="org-type">/</span>2
       0 1  l<span class="org-type">/</span>2
       1 0  h<span class="org-type">/</span>2
       0 1  0];

JMt = [1 0 <span class="org-type">-</span>ha
       0 1  la
       0 1 <span class="org-type">-</span>la];
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">GM = pinv(JMa)<span class="org-type">*</span>G<span class="org-type">*</span>pinv(JMt<span class="org-type">'</span>);
GM.InputName  = {<span class="org-string">'Fx'</span>, <span class="org-string">'Fy'</span>, <span class="org-string">'Mz'</span>};
GM.OutputName  = {<span class="org-string">'Dx'</span>, <span class="org-string">'Dy'</span>, <span class="org-string">'Rz'</span>};
</pre>
</div>


<div id="org7bdf0c7" class="figure">
<p><img src="figs/jac_decoupling_M.png" alt="jac_decoupling_M.png" />
</p>
<p><span class="figure-number">Figure 21: </span>Diagonal and off-diagonal elements of the decoupled plant</p>
</div>
</div>
</div>

<div id="outline-container-org47aa09c" class="outline-4">
<h4 id="org47aa09c"><span class="section-number-4">1.12.2</span> Decoupling of the stiffness matrix</h4>
<div class="outline-text-4" id="text-1-12-2">

<div id="orga9c8045" class="figure">
<p><img src="figs/gravimeter_model_K.png" alt="gravimeter_model_K.png" />
</p>
<p><span class="figure-number">Figure 22: </span>Choice of {O} such that the Stiffness Matrix is Diagonal</p>
</div>

<p>
Decoupling at the point where K is diagonal (x = 0, y = -h/2 from the schematic {O} frame):
</p>
<div class="org-src-container">
<pre class="src src-matlab">JKa = [1 0  0
       0 1 <span class="org-type">-</span>l<span class="org-type">/</span>2
       1 0 <span class="org-type">-</span>h
       0 1  0];

JKt = [1 0  0
       0 1 <span class="org-type">-</span>la
       0 1  la];
</pre>
</div>

<p>
And the plant \(\bm{G}_x\) is computed:
</p>
<div class="org-src-container">
<pre class="src src-matlab">GK = pinv(JKa)<span class="org-type">*</span>G<span class="org-type">*</span>pinv(JKt<span class="org-type">'</span>);
GK.InputName  = {<span class="org-string">'Fx'</span>, <span class="org-string">'Fy'</span>, <span class="org-string">'Mz'</span>};
GK.OutputName  = {<span class="org-string">'Dx'</span>, <span class="org-string">'Dy'</span>, <span class="org-string">'Rz'</span>};
</pre>
</div>


<div id="orge6322d2" class="figure">
<p><img src="figs/jac_decoupling_K.png" alt="jac_decoupling_K.png" />
</p>
<p><span class="figure-number">Figure 23: </span>Diagonal and off-diagonal elements of the decoupled plant</p>
</div>
</div>
</div>

<div id="outline-container-orgbd7a39a" class="outline-4">
<h4 id="orgbd7a39a"><span class="section-number-4">1.12.3</span> Combined decoupling of the mass and stiffness matrices</h4>
<div class="outline-text-4" id="text-1-12-3">

<div id="org56151cd" class="figure">
<p><img src="figs/gravimeter_model_KM.png" alt="gravimeter_model_KM.png" />
</p>
<p><span class="figure-number">Figure 24: </span>Ideal location of the actuators such that both the mass and stiffness matrices are diagonal</p>
</div>

<p>
To do so, the actuator position should be modified
</p>

<div class="org-src-container">
<pre class="src src-matlab">la = l<span class="org-type">/</span>2; <span class="org-comment">% Position of Act. [m]</span>
ha = 0; <span class="org-comment">% Position of Act. [m]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Name of the Simulink File</span></span>
mdl = <span class="org-string">'gravimeter'</span>;

<span class="org-matlab-cellbreak"><span class="org-comment">%% Input/Output definition</span></span>
clear io; io_i = 1;
io(io_i) = linio([mdl, <span class="org-string">'/F1'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F2'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/F3'</span>], 1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_side'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_side'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_top'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;
io(io_i) = linio([mdl, <span class="org-string">'/Acc_top'</span>], 2, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1;

G = linearize(mdl, io);
G.InputName  = {<span class="org-string">'F1'</span>, <span class="org-string">'F2'</span>, <span class="org-string">'F3'</span>};
G.OutputName = {<span class="org-string">'Ax1'</span>, <span class="org-string">'Ay1'</span>, <span class="org-string">'Ax2'</span>, <span class="org-string">'Ay2'</span>};
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">JMa = [1 0 <span class="org-type">-</span>h<span class="org-type">/</span>2
       0 1  l<span class="org-type">/</span>2
       1 0  h<span class="org-type">/</span>2
       0 1  0];

JMt = [1 0 <span class="org-type">-</span>ha
       0 1  la
       0 1 <span class="org-type">-</span>la];
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">GKM = pinv(JMa)<span class="org-type">*</span>G<span class="org-type">*</span>pinv(JMt<span class="org-type">'</span>);
GKM.InputName  = {<span class="org-string">'Fx'</span>, <span class="org-string">'Fy'</span>, <span class="org-string">'Mz'</span>};
GKM.OutputName  = {<span class="org-string">'Dx'</span>, <span class="org-string">'Dy'</span>, <span class="org-string">'Rz'</span>};
</pre>
</div>


<div id="orge11de53" class="figure">
<p><img src="figs/jac_decoupling_KM.png" alt="jac_decoupling_KM.png" />
</p>
<p><span class="figure-number">Figure 25: </span>Diagonal and off-diagonal elements of the decoupled plant</p>
</div>
</div>
</div>

<div id="outline-container-orgcadeb64" class="outline-4">
<h4 id="orgcadeb64"><span class="section-number-4">1.12.4</span> Conclusion</h4>
<div class="outline-text-4" id="text-1-12-4">
<p>
Ideally, the mechanical system should be designed in order to have a decoupled stiffness matrix at the CoM of the solid.
</p>

<p>
If not the case, the system can either be decoupled as low frequency if the Jacobian are evaluated at a point where the stiffness matrix is decoupled.
Or it can be decoupled at high frequency if the Jacobians are evaluated at the CoM.
</p>
</div>
</div>
</div>

<div id="outline-container-org5130d1c" class="outline-3">
<h3 id="org5130d1c"><span class="section-number-3">1.13</span> SVD decoupling performances</h3>
<div class="outline-text-3" id="text-1-13">
<p>
<a id="orgb78f794"></a>
As the SVD is applied on a <b>real approximation</b> of the plant dynamics at a frequency \(\omega_0\), it is foreseen that the effectiveness of the decoupling depends on the validity of the real approximation.
</p>

<p>
Let&rsquo;s do the SVD decoupling on a plant that is mostly real (low damping) and one with a large imaginary part (larger damping).
</p>

<p>
Start with small damping, the obtained diagonal and off-diagonal terms are shown in Figure <a href="#orgfe3055a">26</a>.
</p>
<div class="org-src-container">
<pre class="src src-matlab">c = 2e1; <span class="org-comment">% Actuator Damping [N/(m/s)]</span>
</pre>
</div>


<div id="orgfe3055a" class="figure">
<p><img src="figs/gravimeter_svd_low_damping.png" alt="gravimeter_svd_low_damping.png" />
</p>
<p><span class="figure-number">Figure 26: </span>Diagonal and off-diagonal term when decoupling with SVD on the gravimeter with small damping</p>
</div>

<p>
Now take a larger damping, the obtained diagonal and off-diagonal terms are shown in Figure <a href="#org3193efb">27</a>.
</p>
<div class="org-src-container">
<pre class="src src-matlab">c = 5e2; <span class="org-comment">% Actuator Damping [N/(m/s)]</span>
</pre>
</div>


<div id="org3193efb" class="figure">
<p><img src="figs/gravimeter_svd_high_damping.png" alt="gravimeter_svd_high_damping.png" />
</p>
<p><span class="figure-number">Figure 27: </span>Diagonal and off-diagonal term when decoupling with SVD on the gravimeter with high damping</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org985b94e" class="outline-2">
<h2 id="org985b94e"><span class="section-number-2">2</span> Parallel Manipulator with Collocated actuator/sensor pairs</h2>
<div class="outline-text-2" id="text-2">
<p>
<a id="orgf7d82f2"></a>
</p>
<p>
In this section, we will see how the Jacobian matrix can be used to decouple a specific set of mechanical systems (described in Section <a href="#org6b8f946">2.1</a>).
</p>

<p>
The basic decoupling architecture is shown in Figure <a href="#orga17f8f2">29</a> where the Jacobian matrix is used to both compute the actuator forces from forces/torques that are to be applied in a specific defined frame, and to compute the displacement/rotation of the same mass from several sensors.
</p>

<p>
This is rapidly explained in Section <a href="#org5d2cfc0">2.2</a>.
</p>


<div id="org561bd15" class="figure">
<p><img src="figs/block_diagram_jacobian_decoupling.png" alt="block_diagram_jacobian_decoupling.png" />
</p>
</div>

<p>
Depending on the chosen frame, the Stiffness matrix in that particular frame can be computed.
This is explained in Section <a href="#orgc0d6ab4">2.3</a>.
</p>

<p>
Then three decoupling in three specific frames is studied:
</p>
<ul class="org-ul">
<li>Section <a href="#org990d077">2.4</a>: control in the frame of the legs</li>
<li>Section <a href="#org56ab882">2.5</a>: control in a frame whose origin is at the center of mass of the payload</li>
<li>Section <a href="#org32db011">2.6</a>: control in a frame whose origin is located at the &ldquo;center of stiffness&rdquo; of the system</li>
</ul>

<p>
Conclusions are drawn in Section <a href="#orgc95df30">2.7</a>.
</p>
</div>

<div id="outline-container-orgb9992cf" class="outline-3">
<h3 id="orgb9992cf"><span class="section-number-3">2.1</span> Model</h3>
<div class="outline-text-3" id="text-2-1">
<p>
<a id="org6b8f946"></a>
</p>

<p>
Let&rsquo;s consider a parallel manipulator with several collocated actuator/sensors pairs.
</p>

<p>
System in Figure <a href="#orga17f8f2">29</a> will serve as an example.
</p>

<p>
We will note:
</p>
<ul class="org-ul">
<li>\(b_i\): location of the joints on the top platform</li>
<li>\(\hat{s}_i\): unit vector corresponding to the struts direction</li>
<li>\(k_i\): stiffness of the struts</li>
<li>\(\tau_i\): actuator forces</li>
<li>\(O_M\): center of mass of the solid body</li>
<li>\(\mathcal{L}_i\): relative displacement of the struts</li>
</ul>


<div id="orga17f8f2" class="figure">
<p><img src="figs/gravimeter_model_analytical.png" alt="gravimeter_model_analytical.png" />
</p>
<p><span class="figure-number">Figure 29: </span>Model of the gravimeter</p>
</div>

<p>
The parameters are defined as follows:
</p>
<div class="org-src-container">
<pre class="src src-matlab">l  = 1.0; <span class="org-comment">% Length of the mass [m]</span>
h  = 2<span class="org-type">*</span>1.7; <span class="org-comment">% Height of the mass [m]</span>

la = l<span class="org-type">/</span>2; <span class="org-comment">% Position of Act. [m]</span>
ha = h<span class="org-type">/</span>2; <span class="org-comment">% Position of Act. [m]</span>

m = 400; <span class="org-comment">% Mass [kg]</span>
I = 115; <span class="org-comment">% Inertia [kg m^2]</span>

c1 = 2e1; <span class="org-comment">% Actuator Damping [N/(m/s)]</span>
c2 = 2e1; <span class="org-comment">% Actuator Damping [N/(m/s)]</span>
c3 = 2e1; <span class="org-comment">% Actuator Damping [N/(m/s)]</span>

k1 = 15e3; <span class="org-comment">% Actuator Stiffness [N/m]</span>
k2 = 15e3; <span class="org-comment">% Actuator Stiffness [N/m]</span>
k3 = 15e3; <span class="org-comment">% Actuator Stiffness [N/m]</span>
</pre>
</div>

<p>
Let&rsquo;s express \({}^Mb_i\) and \(\hat{s}_i\):
</p>
\begin{align}
{}^Mb_1 &= [-l/2,\ -h_a] \\
{}^Mb_2 &= [-la, \ -h/2] \\
{}^Mb_3 &= [ la, \ -h/2]
\end{align}

\begin{align}
\hat{s}_1 &= [1,\ 0] \\
\hat{s}_2 &= [0,\ 1] \\
\hat{s}_3 &= [0,\ 1]
\end{align}

<div class="org-src-container">
<pre class="src src-matlab">s1 = [1;0];
s2 = [0;1];
s3 = [0;1];

Mb1 = [<span class="org-type">-</span>l<span class="org-type">/</span>2;<span class="org-type">-</span>ha];
Mb2 = [<span class="org-type">-</span>la; <span class="org-type">-</span>h<span class="org-type">/</span>2];
Mb3 = [ la; <span class="org-type">-</span>h<span class="org-type">/</span>2];
</pre>
</div>

<p>
Frame \(\{K\}\) is chosen such that the stiffness matrix is diagonal (explained in Section <a href="#org45ae8ce">3</a>).
</p>

<p>
The positions \({}^Kb_i\) are then:
</p>
\begin{align}
{}^Kb_1 &= [-l/2,\ 0] \\
{}^Kb_2 &= [-la, \ -h/2+h_a] \\
{}^Kb_3 &= [ la, \ -h/2+h_a]
\end{align}

<div class="org-src-container">
<pre class="src src-matlab">Kb1 = [<span class="org-type">-</span>l<span class="org-type">/</span>2; 0];
Kb2 = [<span class="org-type">-</span>la; <span class="org-type">-</span>h<span class="org-type">/</span>2<span class="org-type">+</span>ha];
Kb3 = [ la; <span class="org-type">-</span>h<span class="org-type">/</span>2<span class="org-type">+</span>ha];
</pre>
</div>
</div>
</div>

<div id="outline-container-orga79b2bf" class="outline-3">
<h3 id="orga79b2bf"><span class="section-number-3">2.2</span> The Jacobian Matrix</h3>
<div class="outline-text-3" id="text-2-2">
<p>
<a id="org5d2cfc0"></a>
</p>

<p>
Let&rsquo;s note:
</p>
<ul class="org-ul">
<li><p>
\(\bm{\mathcal{L}}\) the vector of actuator displacement:
</p>
\begin{equation}
  \bm{\mathcal{L}} = \begin{bmatrix} \mathcal{L}_1 \\ \mathcal{L}_2 \\ \mathcal{L}_3 \end{bmatrix}
\end{equation}</li>
<li><p>
\(\bm{\tau}\) the vector of actuator forces:
</p>
\begin{equation}
  \bm{\tau} = \begin{bmatrix} \tau_1 \\ \tau_2 \\ \tau_3 \end{bmatrix}
\end{equation}</li>
<li><p>
\(\bm{\mathcal{F}}_{\{O\}}\) the vector of forces/torques applied on the payload on expressed in frame \(\{O\}\):
</p>
\begin{equation}
  \bm{\mathcal{F}}_{\{O\}} = \begin{bmatrix} \mathcal{F}_{\{O\},x} \\ \mathcal{F}_{\{O\},y} \\ \mathcal{M}_{\{O\},z} \end{bmatrix}
\end{equation}</li>
<li><p>
\(\bm{\mathcal{X}}_{\{O\}}\) the vector of displacement of the payload with respect to frame \(\{O\}\):
</p>
\begin{equation}
  \bm{\mathcal{X}}_{\{O\}} = \begin{bmatrix} \mathcal{X}_{\{O\},x} \\ \mathcal{X}_{\{O\},y} \\ \mathcal{X}_{\{O\},R_z} \end{bmatrix}
\end{equation}</li>
</ul>



<p>
The Jacobian matrix can be used to:
</p>
<ul class="org-ul">
<li>Convert joints velocity \(\dot{\mathcal{L}}\) to payload velocity and angular velocity \(\dot{\bm{\mathcal{X}}}_{\{O\}}\):
\[ \dot{\bm{\mathcal{X}}}_{\{O\}} = J_{\{O\}} \dot{\bm{\mathcal{L}}} \]</li>
<li>Convert actuators forces \(\bm{\tau}\) to forces/torque applied on the payload \(\bm{\mathcal{F}}_{\{O\}}\):
\[ \bm{\mathcal{F}}_{\{O\}} = J_{\{O\}}^T \bm{\tau} \]</li>
</ul>
<p>
with \(\{O\}\) any chosen frame.
</p>

<p>
If we consider <b>small</b> displacements, we have an approximate relation that links the displacements (instead of velocities):
</p>
\begin{equation}
\bm{\mathcal{X}}_{\{M\}} = J_{\{M\}} \bm{\mathcal{L}}
\end{equation}


<p>
The Jacobian can be computed as follows:
</p>
\begin{equation}
J_{\{O\}} = \begin{bmatrix}
  {}^O\hat{s}_1^T & {}^Ob_{1,x} {}^O\hat{s}_{1,y} - {}^Ob_{1,x} {}^O\hat{s}_{1,y} \\
  {}^O\hat{s}_2^T & {}^Ob_{2,x} {}^O\hat{s}_{2,y} - {}^Ob_{2,x} {}^O\hat{s}_{2,y} \\
  \vdots          & \vdots                            \\
  {}^O\hat{s}_n^T & {}^Ob_{n,x} {}^O\hat{s}_{n,y} - {}^Ob_{n,x} {}^O\hat{s}_{n,y} \\
\end{bmatrix}
\end{equation}


<p>
Let&rsquo;s compute the Jacobian matrix in frame \(\{M\}\) and \(\{K\}\):
</p>
<div class="org-src-container">
<pre class="src src-matlab">Jm = [s1<span class="org-type">'</span>, Mb1(1)<span class="org-type">*</span>s1(2)<span class="org-type">-</span>Mb1(2)<span class="org-type">*</span>s1(1);
      s2<span class="org-type">'</span>, Mb2(1)<span class="org-type">*</span>s2(2)<span class="org-type">-</span>Mb2(2)<span class="org-type">*</span>s2(1);
      s3<span class="org-type">'</span>, Mb3(1)<span class="org-type">*</span>s3(2)<span class="org-type">-</span>Mb3(2)<span class="org-type">*</span>s3(1)];
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 4:</span> Jacobian Matrix \(J_{\{M\}}\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1.7</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">-0.5</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0.5</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-matlab">Jk = [s1<span class="org-type">'</span>, Kb1(1)<span class="org-type">*</span>s1(2)<span class="org-type">-</span>Kb1(2)<span class="org-type">*</span>s1(1);
      s2<span class="org-type">'</span>, Kb2(1)<span class="org-type">*</span>s2(2)<span class="org-type">-</span>Kb2(2)<span class="org-type">*</span>s2(1);
      s3<span class="org-type">'</span>, Kb3(1)<span class="org-type">*</span>s3(2)<span class="org-type">-</span>Kb3(2)<span class="org-type">*</span>s3(1)];
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 5:</span> Jacobian Matrix \(J_{\{K\}}\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">-0.5</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0.5</td>
</tr>
</tbody>
</table>

<p>
In the frame \(\{M\}\), the Jacobian is:
</p>
\begin{equation}
J_{\{M\}} = \begin{bmatrix} 1 & 0 & h_a \\ 0 & 1 & -l_a \\ 0 & 1 & l_a \end{bmatrix}
\end{equation}

<p>
And in frame \(\{K\}\), the Jacobian is:
</p>
\begin{equation}
J_{\{K\}} = \begin{bmatrix} 1 & 0 & 0 \\ 0 & 1 & -l_a \\ 0 & 1 & l_a \end{bmatrix}
\end{equation}
</div>
</div>

<div id="outline-container-org1ad970b" class="outline-3">
<h3 id="org1ad970b"><span class="section-number-3">2.3</span> The Stiffness Matrix</h3>
<div class="outline-text-3" id="text-2-3">
<p>
<a id="orgc0d6ab4"></a>
</p>

<p>
For a parallel manipulator, the stiffness matrix expressed in a frame \(\{O\}\) is:
</p>
\begin{equation}
  K_{\{O\}} = J_{\{O\}}^T \mathcal{K} J_{\{O\}}
\end{equation}
<p>
where:
</p>
<ul class="org-ul">
<li>\(J_{\{O\}}\) is the Jacobian matrix expressed in frame \(\{O\}\)</li>
<li><p>
\(\mathcal{K}\) is a diagonal matrix with the strut stiffnesses on the diagonal
</p>
\begin{equation}
\mathcal{K} = \begin{bmatrix}
  k_1 &     &        & 0 \\
      & k_2 &        &   \\
      &     & \ddots &   \\
  0   &     &        & k_n
\end{bmatrix}
\end{equation}</li>
</ul>

<p>
We have the same thing for the damping matrix.
</p>

<div class="org-src-container">
<pre class="src src-matlab">Kr = diag([k1,k2,k3]);
Cr = diag([c1,c2,c3]);
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9522ed" class="outline-3">
<h3 id="orga9522ed"><span class="section-number-3">2.4</span> Equations of motion - Frame of the legs</h3>
<div class="outline-text-3" id="text-2-4">
<p>
<a id="org990d077"></a>
</p>

<p>
Applying the second Newton&rsquo;s law on the system in Figure <a href="#orga17f8f2">29</a> at its center of mass \(O_M\), we obtain:
</p>
\begin{equation}
\left( M_{\{M\}} s^2 + K_{\{M\}} \right) \bm{\mathcal{X}}_{\{M\}} = \bm{\mathcal{F}}_{\{M\}}
\end{equation}
<p>
with:
</p>
<ul class="org-ul">
<li>\(M_{\{M\}}\) is the mass matrix expressed in \(\{M\}\):
\[ M_{\{M\}} = \begin{bmatrix}m & 0 & 0 \\ 0 & m & 0 \\ 0 & 0 & I\end{bmatrix} \]</li>
<li>\(K_{\{M\}}\) is the stiffness matrix expressed in \(\{M\}\):
\[ K_{\{M\}} = J_{\{M\}}^T \mathcal{K} J_{\{M\}} \]</li>
<li>\(\bm{\mathcal{X}}_{\{M\}}\) are displacements/rotations of the mass \(x\), \(y\), \(R_z\) expressed in the frame \(\{M\}\)</li>
<li>\(\bm{\mathcal{F}}_{\{M\}}\) are forces/torques \(\mathcal{F}_x\), \(\mathcal{F}_y\), \(\mathcal{M}_z\) applied at the origin of \(\{M\}\)</li>
</ul>

<p>
Let&rsquo;s use the Jacobian matrix to compute the equations in terms of actuator forces \(\bm{\tau}\) and strut displacement \(\bm{\mathcal{L}}\):
</p>
\begin{equation}
\left( M_{\{M\}} s^2 + K_{\{M\}} \right) J_{\{M\}}^{-1} \bm{\mathcal{L}} = J_{\{M\}}^T \bm{\tau}
\end{equation}

<p>
And we obtain:
</p>
\begin{equation}
\left( J_{\{M\}}^{-T} M_{\{M\}} J_{\{M\}}^{-1} s^2 + \mathcal{K} \right) \bm{\mathcal{L}} = \bm{\tau}
\end{equation}

<p>
The transfer function \(\bm{G}(s)\) from \(\bm{\tau}\) to \(\bm{\mathcal{L}}\) is:
</p>
\begin{equation}
\boxed{\bm{G}(s) = {\left( J_{\{M\}}^{-T} M_{\{M\}} J_{\{M\}}^{-1} s^2 + \mathcal{K} \right)}^{-1}}
\end{equation}


<div id="org5a4ddd7" class="figure">
<p><img src="figs/gravimeter_block_decentralized.png" alt="gravimeter_block_decentralized.png" />
</p>
<p><span class="figure-number">Figure 30: </span>Block diagram of the transfer function from \(\bm{\tau}\) to \(\bm{\mathcal{L}}\)</p>
</div>

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Mass Matrix in frame {M}</span></span>
Mm = diag([m,m,I]);
</pre>
</div>

<p>
Let&rsquo;s note the mass matrix in the frame of the legs:
</p>
\begin{equation}
M_{\{L\}} = J_{\{M\}}^{-T} M_{\{M\}} J_{\{M\}}^{-1}
\end{equation}

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Mass Matrix in the frame of the struts</span></span>
Ml = inv(Jm<span class="org-type">'</span>)<span class="org-type">*</span>Mm<span class="org-type">*</span>inv(Jm);
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 6:</span> \(M_{\{L\}}\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">400</td>
<td class="org-right">680</td>
<td class="org-right">-680</td>
</tr>

<tr>
<td class="org-right">680</td>
<td class="org-right">1371</td>
<td class="org-right">-1171</td>
</tr>

<tr>
<td class="org-right">-680</td>
<td class="org-right">-1171</td>
<td class="org-right">1371</td>
</tr>
</tbody>
</table>

<p>
As we can see, the Stiffness matrix in the frame of the legs is diagonal.
This means the plant dynamics will be diagonal at low frequency.
</p>
<div class="org-src-container">
<pre class="src src-matlab">Kl = diag([k1, k2, k3]);
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 7:</span> \(K_{\{L\}} = \mathcal{K}\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">15000</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">15000</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">15000</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-matlab">Cl = diag([c1, c2, c3]);
</pre>
</div>

<p>
The transfer function \(\bm{G}(s)\) from \(\bm{\tau}\) to \(\bm{\mathcal{L}}\) is defined below and its magnitude is shown in Figure <a href="#orgcfddfbe">31</a>.
</p>
<div class="org-src-container">
<pre class="src src-matlab">Gl = inv(Ml<span class="org-type">*</span>s<span class="org-type">^</span>2 <span class="org-type">+</span> Cl<span class="org-type">*</span>s <span class="org-type">+</span> Kl);
</pre>
</div>

<p>
We can indeed see that the system is well decoupled at low frequency.
</p>


<div id="orgcfddfbe" class="figure">
<p><img src="figs/plant_frame_L.png" alt="plant_frame_L.png" />
</p>
<p><span class="figure-number">Figure 31: </span>Dynamics from \(\bm{\tau}\) to \(\bm{\mathcal{L}}\)</p>
</div>
</div>
</div>

<div id="outline-container-orgb74febb" class="outline-3">
<h3 id="orgb74febb"><span class="section-number-3">2.5</span> Equations of motion - &ldquo;Center of mass&rdquo; {M}</h3>
<div class="outline-text-3" id="text-2-5">
<p>
<a id="org56ab882"></a>
</p>

<p>
The equations of motion expressed in frame \(\{M\}\) are:
</p>
\begin{equation}
\left( M_{\{M\}} s^2 + K_{\{M\}} \right) \bm{\mathcal{X}}_{\{M\}} = \bm{\mathcal{F}}_{\{M\}}
\end{equation}

<p>
And the plant from \(\bm{F}_{\{M\}}\) to \(\bm{\mathcal{X}}_{\{M\}}\) is:
</p>
\begin{equation}
\boxed{\bm{G}_{\{X\}} = {\left( M_{\{M\}} s^2 + K_{\{M\}} \right)}^{-1}}
\end{equation}
<p>
with:
</p>
<ul class="org-ul">
<li>\(M_{\{M\}}\) is the mass matrix expressed in \(\{M\}\):
\[ M_{\{M\}} = \begin{bmatrix}m & 0 & 0 \\ 0 & m & 0 \\ 0 & 0 & I\end{bmatrix} \]</li>
<li>\(K_{\{M\}}\) is the stiffness matrix expressed in \(\{M\}\):
\[ K_{\{M\}} = J_{\{M\}}^T \mathcal{K} J_{\{M\}} \]</li>
</ul>


<div id="orgce8782b" class="figure">
<p><img src="figs/gravimeter_block_com.png" alt="gravimeter_block_com.png" />
</p>
<p><span class="figure-number">Figure 32: </span>Block diagram of the transfer function from \(\bm{\mathcal{F}}_{\{M\}}\) to \(\bm{\mathcal{X}}_{\{M\}}\)</p>
</div>


<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Mass Matrix in frame {M}</span></span>
Mm = diag([m,m,I]);
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 8:</span> Mass matrix expressed in \(\{M\}\): \(M_{\{M\}}\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">400</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">400</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">115</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Stiffness Matrix in frame {M}</span></span>
Km = Jm<span class="org-type">'*</span>Kr<span class="org-type">*</span>Jm;
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 9:</span> Stiffness matrix expressed in \(\{M\}\): \(K_{\{M\}}\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">15000</td>
<td class="org-right">0</td>
<td class="org-right">25500</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">30000</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">25500</td>
<td class="org-right">0</td>
<td class="org-right">50850</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Damping Matrix in frame {M}</span></span>
Cm = Jm<span class="org-type">'*</span>Cr<span class="org-type">*</span>Jm;
</pre>
</div>

<p>
The plant from \(\bm{F}_{\{M\}}\) to \(\bm{\mathcal{X}}_{\{M\}}\) is defined below and its magnitude is shown in Figure <a href="#org4e3147d">33</a>.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Plant in frame {M}</span></span>
Gm = inv(Mm<span class="org-type">*</span>s<span class="org-type">^</span>2 <span class="org-type">+</span> Cm<span class="org-type">*</span>s <span class="org-type">+</span> Km);
</pre>
</div>

<p>
And the system is well decoupled at high frequency (above the suspension modes).
</p>


<div id="org4e3147d" class="figure">
<p><img src="figs/plant_frame_M.png" alt="plant_frame_M.png" />
</p>
<p><span class="figure-number">Figure 33: </span>Dynamics from \(\bm{\mathcal{F}}_{\{M\}}\) to \(\bm{\mathcal{X}}_{\{M\}}\)</p>
</div>
</div>
</div>

<div id="outline-container-org3c2d106" class="outline-3">
<h3 id="org3c2d106"><span class="section-number-3">2.6</span> Equations of motion - &ldquo;Center of stiffness&rdquo; {K}</h3>
<div class="outline-text-3" id="text-2-6">
<p>
<a id="org32db011"></a>
</p>

<p>
Let&rsquo;s now express the transfer function from \(\bm{\mathcal{F}}_{\{K\}}\) to \(\bm{\mathcal{X}}_{\{K\}}\).
We start from:
</p>
\begin{equation}
\left( M_{\{M\}} s^2 + K_{\{M\}} \right) J_{\{M\}}^{-1} \bm{\mathcal{L}} = J_{\{M\}}^T \bm{\tau}
\end{equation}

<p>
And we make use of the Jacobian \(J_{\{K\}}\) to obtain:
</p>
\begin{equation}
\left( M_{\{M\}} s^2 + K_{\{M\}} \right) J_{\{M\}}^{-1} J_{\{K\}} \bm{\mathcal{X}}_{\{K\}} = J_{\{M\}}^T J_{\{K\}}^{-T} \bm{\mathcal{F}}_{\{K\}}
\end{equation}

<p>
And finally:
</p>
\begin{equation}
\left( J_{\{K\}}^T J_{\{M\}}^{-T} M_{\{M\}} J_{\{M\}}^{-1} J_{\{K\}} s^2 + J_{\{K\}}^T \mathcal{K} J_{\{K\}} \right) \bm{\mathcal{X}}_{\{K\}} = \bm{\mathcal{F}}_{\{K\}}
\end{equation}

<p>
The transfer function from \(\bm{\mathcal{F}}_{\{K\}}\) to \(\bm{\mathcal{X}}_{\{K\}}\) is then:
</p>
\begin{equation}
\boxed{\bm{G}_{\{K\}} = {\left( J_{\{K\}}^T J_{\{M\}}^{-T} M_{\{M\}} J_{\{M\}}^{-1} J_{\{K\}} s^2 + J_{\{K\}}^T \mathcal{K} J_{\{K\}} \right)}^{-1}}
\end{equation}

<p>
The frame \(\{K\}\) has been chosen such that \(J_{\{K\}}^T \mathcal{K} J_{\{K\}}\) is diagonal.
</p>


<div id="org62eef29" class="figure">
<p><img src="figs/gravimeter_block_cok.png" alt="gravimeter_block_cok.png" />
</p>
<p><span class="figure-number">Figure 34: </span>Block diagram of the transfer function from \(\bm{\mathcal{F}}_{\{K\}}\) to \(\bm{\mathcal{X}}_{\{K\}}\)</p>
</div>

<div class="org-src-container">
<pre class="src src-matlab">Mk = Jk<span class="org-type">'*</span>inv(Jm)<span class="org-type">'*</span>Mm<span class="org-type">*</span>inv(Jm)<span class="org-type">*</span>Jk;
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 10:</span> Mass matrix expressed in \(\{K\}\): \(M_{\{K\}}\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">400</td>
<td class="org-right">0</td>
<td class="org-right">-680</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">400</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">-680</td>
<td class="org-right">0</td>
<td class="org-right">1271</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-matlab">Kk = Jk<span class="org-type">'*</span>Kr<span class="org-type">*</span>Jk;
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 11:</span> Stiffness matrix expressed in \(\{K\}\): \(K_{\{K\}}\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">15000</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">30000</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">7500</td>
</tr>
</tbody>
</table>

<p>
The plant from \(\bm{F}_{\{K\}}\) to \(\bm{\mathcal{X}}_{\{K\}}\) is defined below and its magnitude is shown in Figure <a href="#orga840eb1">35</a>.
</p>
<div class="org-src-container">
<pre class="src src-matlab">Gk = inv(Mk<span class="org-type">*</span>s<span class="org-type">^</span>2 <span class="org-type">+</span> Ck<span class="org-type">*</span>s <span class="org-type">+</span> Kk);
</pre>
</div>


<div id="orga840eb1" class="figure">
<p><img src="figs/plant_frame_K.png" alt="plant_frame_K.png" />
</p>
<p><span class="figure-number">Figure 35: </span>Dynamics from \(\bm{\mathcal{F}}_{\{K\}}\) to \(\bm{\mathcal{X}}_{\{K\}}\)</p>
</div>
</div>
</div>

<div id="outline-container-orgd1004c1" class="outline-3">
<h3 id="orgd1004c1"><span class="section-number-3">2.7</span> Conclusion</h3>
<div class="outline-text-3" id="text-2-7">
<p>
<a id="orgc95df30"></a>
</p>

<p>
Jacobian matrices can be used to decouple the presented system.
</p>

<p>
Depending on the chosen frame used for the estimation of the Jacobian, different plant dynamics is obtained.
</p>
</div>
</div>
</div>

<div id="outline-container-org3a64a45" class="outline-2">
<h2 id="org3a64a45"><span class="section-number-2">3</span> Diagonal Stiffness Matrix for a planar manipulator</h2>
<div class="outline-text-2" id="text-3">
<p>
<a id="org45ae8ce"></a>
</p>
</div>
<div id="outline-container-orgdd8ae63" class="outline-3">
<h3 id="orgdd8ae63"><span class="section-number-3">3.1</span> Model and Assumptions</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Consider a parallel manipulator with:
</p>
<ul class="org-ul">
<li>\(b_i\): location of the joints on the top platform are called \(b_i\)</li>
<li>\(\hat{s}_i\): unit vector corresponding to the struts</li>
<li>\(k_i\): stiffness of the struts</li>
<li>\(\tau_i\): actuator forces</li>
<li>\(O_M\): center of mass of the solid body</li>
</ul>

<p>
Consider two frames:
</p>
<ul class="org-ul">
<li>\(\{M\}\) with origin \(O_M\)</li>
<li>\(\{K\}\) with origin \(O_K\)</li>
</ul>

<p>
As an example, take the system shown in Figure <a href="#orgcb134c0">36</a>.
</p>


<div id="orgcb134c0" class="figure">
<p><img src="figs/3dof_model_fully_parallel.png" alt="3dof_model_fully_parallel.png" />
</p>
<p><span class="figure-number">Figure 36: </span>Example of 3DoF parallel platform</p>
</div>
</div>
</div>

<div id="outline-container-org57315a0" class="outline-3">
<h3 id="org57315a0"><span class="section-number-3">3.2</span> Objective</h3>
<div class="outline-text-3" id="text-3-2">
<p>
The objective is to find conditions for the existence of a frame \(\{K\}\) in which the Stiffness matrix of the manipulator is diagonal.
If the conditions are fulfilled, a second objective is to fine the location of the frame \(\{K\}\) analytically.
</p>
</div>
</div>

<div id="outline-container-orgf65bc66" class="outline-3">
<h3 id="orgf65bc66"><span class="section-number-3">3.3</span> Conditions for Diagonal Stiffness</h3>
<div class="outline-text-3" id="text-3-3">
<p>
The stiffness matrix in the frame \(\{K\}\) can be expressed as:
</p>
\begin{equation} \label{eq:stiffness_formula_planar}
  K_{\{K\}} = J_{\{K\}}^T \mathcal{K} J_{\{K\}}
\end{equation}
<p>
where:
</p>
<ul class="org-ul">
<li>\(J_{\{K\}}\) is the Jacobian transformation from the struts to the frame \(\{K\}\)</li>
<li><p>
\(\mathcal{K}\) is a diagonal matrix with the strut stiffnesses on the diagonal
</p>
\begin{equation}
\mathcal{K} = \begin{bmatrix}
  k_1 &     &        & 0 \\
      & k_2 &        &   \\
      &     & \ddots &   \\
  0   &     &        & k_n
\end{bmatrix}
\end{equation}</li>
</ul>

<p>
The Jacobian for a planar manipulator, evaluated in a frame \(\{K\}\), can be expressed as follows:
</p>
\begin{equation} \label{eq:jacobian_planar}
J_{\{K\}} = \begin{bmatrix}
  {}^K\hat{s}_1^T & {}^Kb_{1,x} {}^K\hat{s}_{1,y} - {}^Kb_{1,x} {}^K\hat{s}_{1,y} \\
  {}^K\hat{s}_2^T & {}^Kb_{2,x} {}^K\hat{s}_{2,y} - {}^Kb_{2,x} {}^K\hat{s}_{2,y} \\
  \vdots          & \vdots                            \\
  {}^K\hat{s}_n^T & {}^Kb_{n,x} {}^K\hat{s}_{n,y} - {}^Kb_{n,x} {}^K\hat{s}_{n,y} \\
\end{bmatrix}
\end{equation}

<p>
Let&rsquo;s omit the mention of frame, it is assumed that vectors are expressed in frame \(\{K\}\).
It is specified otherwise.
</p>

<p>
Injecting \eqref{eq:jacobian_planar} into \eqref{eq:stiffness_formula_planar} yields:
</p>
\begin{equation}
\boxed{
K_{\{K\}} = \left[ \begin{array}{c|c}
  k_i \hat{s}_i \hat{s}_i^T              & k_i \hat{s}_i (b_{i,x}\hat{s}_{i,y} - b_{i,y}\hat{s}_{i,x}) \cr
  \hline
  k_i \hat{s}_i (b_{i,x}\hat{s}_{i,y} - b_{i,y}\hat{s}_{i,x}) & k_i (b_{i,x}\hat{s}_{i,y} - b_{i,y}\hat{s}_{i,x})^2
\end{array} \right]
}
\end{equation}

<p>
In order to have a decoupled stiffness matrix, we have the following two conditions:
</p>
\begin{align}
k_i \hat{s}_i \hat{s}_i^T &= \text{diag. matrix} \label{eq:diag_cond_2D_1} \\
k_i \hat{s}_i (b_{i,x}\hat{s}_{i,y} - b_{i,y}\hat{s}_{i,x}) &= 0 \label{eq:diag_cond_2D_2}
\end{align}

<p>
Note that we don&rsquo;t have any condition on the term \(k_i (b_{i,x}\hat{s}_{i,y} - b_{i,y}\hat{s}_{i,x})^2\) as it is only a scalar.
</p>

<p>
Condition \eqref{eq:diag_cond_2D_1}:
</p>
<ul class="org-ul">
<li>represents the coupling between translations and forces</li>
<li>does only depends on the orientation of the struts and the stiffnesses and not on the choice of frame</li>
<li>it is therefore a intrinsic property of the chosen geometry</li>
</ul>

<p>
Condition \eqref{eq:diag_cond_2D_2}:
</p>
<ul class="org-ul">
<li>represents the coupling between forces/rotations and torques/translation</li>
<li>it does depend on the positions of the joints \(b_i\) in the frame \(\{K\}\)</li>
</ul>

<p>
Let&rsquo;s make a change of frame from the initial frame \(\{M\}\) to the frame \(\{K\}\):
</p>
\begin{align}
{}^Kb_i &= {}^Mb_i - {}^MO_K \\
{}^K\hat{s}_i &= {}^M\hat{s}_i
\end{align}

<p>
And the goal is to find \({}^MO_K\) such that \eqref{eq:diag_cond_2D_2} is fulfilled:
</p>
\begin{equation}
k_i ({}^Mb_{i,x}\hat{s}_{i,y} - {}^Mb_{i,y}\hat{s}_{i,x} - {}^MO_{K,x}\hat{s}_{i,y} + {}^MO_{K,y}\hat{s}_{i,x}) \hat{s}_i = 0
\end{equation}
\begin{equation}
k_i ({}^Mb_{i,x}\hat{s}_{i,y} - {}^Mb_{i,y}\hat{s}_{i,x}) \hat{s}_i = {}^MO_{K,x} k_i \hat{s}_{i,y} \hat{s}_i -  {}^MO_{K,y} k_i \hat{s}_{i,x} \hat{s}_i
\end{equation}

<p>
And we have two sets of linear equations of two unknowns.
</p>

<p>
This can be easily solved by writing the equations in a matrix form:
</p>
\begin{equation}
\underbrace{k_i ({}^Mb_{i,x}\hat{s}_{i,y} - {}^Mb_{i,y}\hat{s}_{i,x}) \hat{s}_i}_{2 \times 1} =
\underbrace{\begin{bmatrix}
& \\
k_i \hat{s}_{i,y} \hat{s}_i & - k_i \hat{s}_{i,x} \hat{s}_i \\
& \\
\end{bmatrix}}_{2 \times 2}
\underbrace{\begin{bmatrix}
{}^MO_{K,x}\\
{}^MO_{K,y}
\end{bmatrix}}_{2 \times 1}
\end{equation}

<p>
And finally, if the matrix is invertible:
</p>
\begin{equation}
\boxed{
{}^MO_K = {\begin{bmatrix}
& \\
k_i \hat{s}_{i,y} \hat{s}_i & - k_i \hat{s}_{i,x} \hat{s}_i \\
& \\
\end{bmatrix}}^{-1} k_i ({}^Mb_{i,x}\hat{s}_{i,y} - {}^Mb_{i,y}\hat{s}_{i,x}) \hat{s}_i
}
\end{equation}

<p>
Note that a rotation of the frame \(\{K\}\) with respect to frame \(\{M\}\) would make not change on the &ldquo;diagonality&rdquo; of \(K_{\{K\}}\).
</p>
</div>
</div>

<div id="outline-container-org06a2a28" class="outline-3">
<h3 id="org06a2a28"><span class="section-number-3">3.4</span> Example 1 - Planar manipulator with 3 actuators</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Consider system of Figure <a href="#org407fd8e">37</a>.
</p>


<div id="org407fd8e" class="figure">
<p><img src="figs/3dof_model_fully_parallel.png" alt="3dof_model_fully_parallel.png" />
</p>
<p><span class="figure-number">Figure 37: </span>Example of 3DoF parallel platform</p>
</div>

<p>
The stiffnesses \(k_i\), the joint positions \({}^Mb_i\) and joint unit vectors \({}^M\hat{s}_i\) are defined below:
</p>
<div class="org-src-container">
<pre class="src src-matlab">ki = [5,1,2]; <span class="org-comment">% Stiffnesses [N/m]</span>
si = [[1;0],[0;1],[0;1]]; si = si<span class="org-type">./</span>vecnorm(si); <span class="org-comment">% Unit Vectors</span>
bi = [[<span class="org-type">-</span>1;0.5],[<span class="org-type">-</span>2;<span class="org-type">-</span>1],[0;<span class="org-type">-</span>1]]; <span class="org-comment">% Joint's positions in frame {M}</span>
</pre>
</div>

<p>
Let&rsquo;s first verify that condition \eqref{eq:diag_cond_2D_1} is true:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">5</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>

<p>
Now, compute \({}^MO_K\):
</p>
<div class="org-src-container">
<pre class="src src-matlab">Ok = inv([sum(ki<span class="org-type">.*</span>si(2,<span class="org-type">:</span>)<span class="org-type">.*</span>si, 2), <span class="org-type">-</span>sum(ki<span class="org-type">.*</span>si(1,<span class="org-type">:</span>)<span class="org-type">.*</span>si, 2)])<span class="org-type">*</span>sum(ki<span class="org-type">.*</span>(bi(1,<span class="org-type">:</span>)<span class="org-type">.*</span>si(2,<span class="org-type">:</span>) <span class="org-type">-</span> bi(2,<span class="org-type">:</span>)<span class="org-type">.*</span>si(1,<span class="org-type">:</span>))<span class="org-type">.*</span>si, 2);
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">-1</td>
</tr>

<tr>
<td class="org-right">0.5</td>
</tr>
</tbody>
</table>

<p>
Let&rsquo;s compute the new coordinates \({}^Kb_i\) after the change of frame:
</p>
<div class="org-src-container">
<pre class="src src-matlab">Kbi = bi <span class="org-type">-</span> Ok;
</pre>
</div>

<p>
In order to verify that the new frame \(\{K\}\) indeed yields a diagonal stiffness matrix, we first compute the Jacobian \(J_{\{K\}}\):
</p>
<div class="org-src-container">
<pre class="src src-matlab">Jk = [si<span class="org-type">'</span>, (Kbi(1,<span class="org-type">:</span>)<span class="org-type">.*</span>si(2,<span class="org-type">:</span>) <span class="org-type">-</span> Kbi(2,<span class="org-type">:</span>)<span class="org-type">.*</span>si(1,<span class="org-type">:</span>))<span class="org-type">'</span>];
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">-1</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>

<p>
And the stiffness matrix:
</p>
<div class="org-src-container">
<pre class="src src-matlab">K = Jk<span class="org-type">'*</span>diag(ki)<span class="org-type">*</span>Jk
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">5</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">2</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orge3c3696" class="outline-3">
<h3 id="orge3c3696"><span class="section-number-3">3.5</span> Example 2 - Planar manipulator with 4 actuators</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Now consider the planar manipulator of Figure <a href="#orgc2180e5">38</a>.
</p>


<div id="orgc2180e5" class="figure">
<p><img src="figs/model_planar_2.png" alt="model_planar_2.png" />
</p>
<p><span class="figure-number">Figure 38: </span>Planar Manipulator</p>
</div>

<p>
The stiffnesses \(k_i\), the joint positions \({}^Mb_i\) and joint unit vectors \({}^M\hat{s}_i\) are defined below:
</p>
<div class="org-src-container">
<pre class="src src-matlab">ki = [1,2,1,1];
si = [[1;0],[0;1],[<span class="org-type">-</span>1;0],[0;1]];
si = si<span class="org-type">./</span>vecnorm(si);
h = 0.2;
L = 2;
bi = [[<span class="org-type">-</span>L<span class="org-type">/</span>2;h],[<span class="org-type">-</span>L<span class="org-type">/</span>2;<span class="org-type">-</span>h],[L<span class="org-type">/</span>2;h],[L<span class="org-type">/</span>2;h]];
</pre>
</div>

<p>
Let&rsquo;s first verify that condition \eqref{eq:diag_cond_2D_1} is true:
</p>
<div class="org-src-container">
<pre class="src src-matlab">ki<span class="org-type">.*</span>si<span class="org-type">*</span>si<span class="org-type">'</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">3</td>
</tr>
</tbody>
</table>

<p>
Now, compute \({}^MO_K\):
</p>
<div class="org-src-container">
<pre class="src src-matlab">Ok = inv([sum(ki<span class="org-type">.*</span>si(2,<span class="org-type">:</span>)<span class="org-type">.*</span>si, 2), <span class="org-type">-</span>sum(ki<span class="org-type">.*</span>si(1,<span class="org-type">:</span>)<span class="org-type">.*</span>si, 2)])<span class="org-type">*</span>sum(ki<span class="org-type">.*</span>(bi(1,<span class="org-type">:</span>)<span class="org-type">.*</span>si(2,<span class="org-type">:</span>) <span class="org-type">-</span> bi(2,<span class="org-type">:</span>)<span class="org-type">.*</span>si(1,<span class="org-type">:</span>))<span class="org-type">.*</span>si, 2);
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">-0.33333</td>
</tr>

<tr>
<td class="org-right">0.2</td>
</tr>
</tbody>
</table>

<p>
Let&rsquo;s compute the new coordinates \({}^Kb_i\) after the change of frame:
</p>
<div class="org-src-container">
<pre class="src src-matlab">Kbi = bi <span class="org-type">-</span> Ok;
</pre>
</div>

<p>
In order to verify that the new frame \(\{K\}\) indeed yields a diagonal stiffness matrix, we first compute the Jacobian \(J_{\{K\}}\):
</p>
<div class="org-src-container">
<pre class="src src-matlab">Jk = [si<span class="org-type">'</span>, (Kbi(1,<span class="org-type">:</span>)<span class="org-type">.*</span>si(2,<span class="org-type">:</span>) <span class="org-type">-</span> Kbi(2,<span class="org-type">:</span>)<span class="org-type">.*</span>si(1,<span class="org-type">:</span>))<span class="org-type">'</span>];
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">-0.66667</td>
</tr>

<tr>
<td class="org-right">-1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1.3333</td>
</tr>
</tbody>
</table>

<p>
And the stiffness matrix:
</p>
<div class="org-src-container">
<pre class="src src-matlab">K = Jk<span class="org-type">'*</span>diag(ki)<span class="org-type">*</span>Jk
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">3</td>
<td class="org-right">-2.2204e-16</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">-2.2204e-16</td>
<td class="org-right">2.6667</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgbc3eaba" class="outline-2">
<h2 id="orgbc3eaba"><span class="section-number-2">4</span> Diagonal Stiffness Matrix for a general parallel manipulator</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org76d5003" class="outline-3">
<h3 id="org76d5003"><span class="section-number-3">4.1</span> Model and Assumptions</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Let&rsquo;s consider a 6dof parallel manipulator with:
</p>
<ul class="org-ul">
<li>\(b_i\): location of the joints on the top platform are called \(b_i\)</li>
<li>\(\hat{s}_i\): unit vector corresponding to the struts</li>
<li>\(k_i\): stiffness of the struts</li>
<li>\(\tau_i\): actuator forces</li>
<li>\(O_M\): center of mass of the solid body</li>
</ul>

<p>
Consider two frames:
</p>
<ul class="org-ul">
<li>\(\{M\}\) with origin \(O_M\)</li>
<li>\(\{K\}\) with origin \(O_K\)</li>
</ul>

<p>
An example is shown in Figure <a href="#org023aaff">39</a>.
</p>


<div id="org023aaff" class="figure">
<p><img src="figs/stewart_architecture_example.png" alt="stewart_architecture_example.png" />
</p>
<p><span class="figure-number">Figure 39: </span>Parallel manipulator Example</p>
</div>
</div>
</div>

<div id="outline-container-org3c8d37f" class="outline-3">
<h3 id="org3c8d37f"><span class="section-number-3">4.2</span> Objective</h3>
<div class="outline-text-3" id="text-4-2">
<p>
The objective is to find conditions for the existence of a frame \(\{K\}\) in which the Stiffness matrix of the manipulator is diagonal.
If the conditions are fulfilled, a second objective is to fine the location of the frame \(\{K\}\) analytically.
</p>
</div>
</div>

<div id="outline-container-org30aace6" class="outline-3">
<h3 id="org30aace6"><span class="section-number-3">4.3</span> Analytical formula of the stiffness matrix</h3>
<div class="outline-text-3" id="text-4-3">
<p>
For a fully parallel manipulator, the stiffness matrix \(K_{\{K\}}\) expressed in a frame \(\{K\}\) is:
</p>
\begin{equation}
  K_{\{K\}} = J_{\{K\}}^T \mathcal{K} J_{\{K\}}
\end{equation}
<p>
where:
</p>
<ul class="org-ul">
<li>\(J_{\{K\}}\) is the Jacobian transformation from the struts to the frame \(\{K\}\)</li>
<li><p>
\(\mathcal{K}\) is a diagonal matrix with the strut stiffnesses on the diagonal:
</p>
\begin{equation}
\mathcal{K} = \begin{bmatrix}
  k_1 &     &        & 0 \\
      & k_2 &        &   \\
      &     & \ddots &   \\
  0   &     &        & k_n
\end{bmatrix}
\end{equation}</li>
</ul>


<p>
The analytical expression of \(J_{\{K\}}\) is:
</p>
\begin{equation}
J_{\{K\}} = \begin{bmatrix}
  {}^K\hat{s}_1^T & ({}^Kb_1 \times {}^K\hat{s}_1)^T \\
  {}^K\hat{s}_2^T & ({}^Kb_2 \times {}^K\hat{s}_2)^T \\
  \vdots          & \vdots                            \\
  {}^K\hat{s}_n^T & ({}^Kb_n \times {}^K\hat{s}_n)^T
\end{bmatrix}
\end{equation}

<p>
To simplify, we ignore the superscript \(K\) and we assume that all vectors / positions are expressed in this frame \(\{K\}\).
Otherwise, it is explicitly written.
</p>

<p>
Let&rsquo;s now write the analytical expressing of the stiffness matrix \(K_{\{K\}}\):
</p>
\begin{equation}
K_{\{K\}} = \begin{bmatrix}
  \hat{s}_1              & \dots & \hat{s}_n \\
  (b_1 \times \hat{s}_1) & \dots & (b_n \times \hat{s}_n)
\end{bmatrix}
\begin{bmatrix}
  k_1 & & \\
      & \ddots & \\
      & & k_n
\end{bmatrix}
\begin{bmatrix}
  \hat{s}_1^T & (b_1 \times \hat{s}_1)^T \\
  \hat{s}_2^T & (b_2 \times \hat{s}_2)^T \\
  \vdots          & \dots                            \\
  \hat{s}_n^T & (b_n \times \hat{s}_n)^T
\end{bmatrix}
\end{equation}

<p>
And we finally obtain:
</p>
\begin{equation}
\boxed{
K_{\{K\}} = \left[ \begin{array}{c|c}
  k_i \hat{s}_i \hat{s}_i^T              & k_i \hat{s}_i (b_i \times \hat{s}_i)^T \cr
  \hline
  k_i (b_i \times \hat{s}_i) \hat{s}_i^T & k_i (b_i \times \hat{s}_i) (b_i \times \hat{s}_i)^T
\end{array} \right]
}
\end{equation}

<p>
We want the stiffness matrix to be diagonal, therefore, we have the following conditions:
</p>
\begin{align}
k_i \hat{s}_i \hat{s}_i^T &= \text{diag. matrix} \label{eq:diag_cond_1} \\
k_i (b_i \times \hat{s}_i) (b_i \times \hat{s}_i)^T &= \text{diag. matrix} \label{eq:diag_cond_2} \\
k_i \hat{s}_i (b_i \times \hat{s}_i)^T &= 0 \label{eq:diag_cond_3}
\end{align}

<p>
Note that:
</p>
<ul class="org-ul">
<li>condition \eqref{eq:diag_cond_1} corresponds to coupling between forces applied on \(O_K\) to translations of the payload.
It does not depend on the choice of \(\{K\}\), it only depends on the orientation of the struts and the stiffnesses.
It is therefore an intrinsic property of the manipulator.</li>
<li>condition \eqref{eq:diag_cond_2} corresponds to the coupling between forces applied on \(O_K\) and rotation of the payload.
Similarly, it does also correspond to the coupling between torques applied on \(O_K\) to translations of the payload.</li>
<li>condition \eqref{eq:diag_cond_3} corresponds to the coupling between torques applied on \(O_K\) to rotation of the payload.</li>
<li>conditions \eqref{eq:diag_cond_2} and \eqref{eq:diag_cond_3} do depend on the positions \({}^Kb_i\) and therefore depend on the choice of \(\{K\}\).</li>
</ul>

<p>
Note that if we find a frame \(\{K\}\) in which the stiffness matrix \(K_{\{K\}}\) is diagonal, it will still be diagonal for any rotation of the frame \(\{K\}\).
Therefore, we here suppose that the frame \(\{K\}\) is aligned with the initial frame \(\{M\}\).
</p>

<p>
Let&rsquo;s make a change of frame from the initial frame \(\{M\}\) to the frame \(\{K\}\):
</p>
\begin{align}
{}^Kb_i &= {}^Mb_i - {}^MO_K \\
{}^K\hat{s}_i &= {}^M\hat{s}_i
\end{align}

<p>
The goal is to find \({}^MO_K\) such that conditions \eqref{eq:diag_cond_2} and \eqref{eq:diag_cond_3} are fulfilled.
</p>

<p>
Let&rsquo;s first solve equation \eqref{eq:diag_cond_3} that corresponds to the coupling between forces and rotations:
</p>
\begin{equation}
k_i \hat{s}_i (({}^Mb_i - {}^MO_K) \times \hat{s}_i)^T = 0
\end{equation}

<p>
Taking the transpose and re-arranging:
</p>
\begin{equation}
k_i ({}^Mb_i \times \hat{s}_i) \hat{s}_i^T = k_i ({}^MO_K \times \hat{s}_i) \hat{s}_i^T
\end{equation}

<p>
As the vector cross product also can be expressed as the product of a skew-symmetric matrix and a vector, we obtain:
</p>
\begin{equation}
k_i ({}^Mb_i \times \hat{s}_i) \hat{s}_i^T = {}^M\bm{O}_{K} ( k_i \hat{s}_i \hat{s}_i^T )
\end{equation}

<p>
with:
</p>
\begin{equation} \label{eq:skew_symmetric_cross_product}
{}^M\bm{O}_K = \begin{bmatrix}
0 & -{}^MO_{K,z} & {}^MO_{K,y} \\
{}^MO_{K,z} & 0 & -{}^MO_{K,x} \\
-{}^MO_{K,y} & {}^MO_{K,x} & 0
\end{bmatrix}
\end{equation}

<p>
We suppose \(k_i \hat{s}_i \hat{s}_i^T\) invertible as it is diagonal from \eqref{eq:diag_cond_1}.
</p>

<p>
And finally, we find:
</p>
\begin{equation}
\boxed{
{}^M\bm{O}_{K} = \left( k_i ({}^Mb_i \times \hat{s}_i) \hat{s}_i^T\right) \cdot {\left( k_i \hat{s}_i \hat{s}_i^T \right)}^{-1}
}
\end{equation}

<p>
If the obtained \({}^M\bm{O}_{K}\) is a skew-symmetric matrix, we can easily determine the corresponding vector \({}^MO_K\) from \eqref{eq:skew_symmetric_cross_product}.
</p>

<p>
In such case, condition \eqref{eq:diag_cond_2} is fulfilled and there is no coupling between translations and rotations in the frame \(\{K\}\).
</p>

<p>
Then, we can only verify if condition \eqref{eq:diag_cond_3} is verified or not.
</p>

<div class="note" id="org5bc0cd3">
<p>
If there is no frame \(\{K\}\) such that conditions \eqref{eq:diag_cond_2} and \eqref{eq:diag_cond_3} are valid, it would be interesting to be able to determine the frame \(\{K\}\) in which is coupling is minimal.
</p>

</div>
</div>
</div>

<div id="outline-container-orgf60e332" class="outline-3">
<h3 id="orgf60e332"><span class="section-number-3">4.4</span> Example 1 - 6DoF manipulator (3D)</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Let&rsquo;s define the geometry of the manipulator (\({}^Mb_i\), \({}^Ms_i\) and \(k_i\)):
</p>
<div class="org-src-container">
<pre class="src src-matlab">ki = [2,2,1,1,3,3,1,1,1,1,2,2];
si = [[<span class="org-type">-</span>1;0;0],[<span class="org-type">-</span>1;0;0],[<span class="org-type">-</span>1;0;0],[<span class="org-type">-</span>1;0;0],[0;0;1],[0;0;1],[0;0;1],[0;0;1],[0;<span class="org-type">-</span>1;0],[0;<span class="org-type">-</span>1;0],[0;<span class="org-type">-</span>1;0],[0;<span class="org-type">-</span>1;0]];
bi = [[1;<span class="org-type">-</span>1;1],[1;1;<span class="org-type">-</span>1],[1;1;1],[1;<span class="org-type">-</span>1;<span class="org-type">-</span>1],[1;<span class="org-type">-</span>1;<span class="org-type">-</span>1],[<span class="org-type">-</span>1;1;<span class="org-type">-</span>1],[1;1;<span class="org-type">-</span>1],[<span class="org-type">-</span>1;<span class="org-type">-</span>1;<span class="org-type">-</span>1],[1;1;<span class="org-type">-</span>1],[<span class="org-type">-</span>1;1;1],[<span class="org-type">-</span>1;1;<span class="org-type">-</span>1],[1;1;1]]<span class="org-type">-</span>[0;2;<span class="org-type">-</span>1];
</pre>
</div>

<p>
Cond 1:
</p>
<div class="org-src-container">
<pre class="src src-matlab">ki<span class="org-type">.*</span>si<span class="org-type">*</span>si<span class="org-type">'</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">6</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">6</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">8</td>
</tr>
</tbody>
</table>

<p>
Find Ok
</p>
<div class="org-src-container">
<pre class="src src-matlab">OkX = (ki<span class="org-type">.*</span>cross(bi, si)<span class="org-type">*</span>si<span class="org-type">'</span>)<span class="org-type">/</span>(ki<span class="org-type">.*</span>si<span class="org-type">*</span>si<span class="org-type">'</span>);

<span class="org-keyword">if</span> all(diag(OkX) <span class="org-type">==</span> 0) <span class="org-type">&amp;&amp;</span> all(all((OkX <span class="org-type">+</span> OkX<span class="org-type">'</span>) <span class="org-type">==</span> 0))
    disp(<span class="org-string">'OkX is skew symmetric'</span>)
    Ok = [OkX(3,2);OkX(1,3);OkX(2,1)]
<span class="org-keyword">else</span>
    error(<span class="org-string">'OkX is *not* skew symmetric'</span>)
<span class="org-keyword">end</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">-2</td>
</tr>

<tr>
<td class="org-right">1</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-comment">% Verification of second condition</span>
si<span class="org-type">*</span>cross(bi<span class="org-type">-</span>Ok, si)<span class="org-type">'</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>

<p>
Verification of third condition
</p>
<div class="org-src-container">
<pre class="src src-matlab">ki<span class="org-type">.*</span>cross(bi<span class="org-type">-</span>Ok, si)<span class="org-type">*</span>cross(bi<span class="org-type">-</span>Ok, si)<span class="org-type">'</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">14</td>
<td class="org-right">4</td>
<td class="org-right">-2</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">14</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">-2</td>
<td class="org-right">2</td>
<td class="org-right">12</td>
</tr>
</tbody>
</table>

<p>
Let&rsquo;s compute the Jacobian:
</p>
<div class="org-src-container">
<pre class="src src-matlab">Jk = [si<span class="org-type">'</span>, cross(bi <span class="org-type">-</span> Ok, si)<span class="org-type">'</span>];
</pre>
</div>

<p>
And the stiffness matrix:
</p>
<div class="org-src-container">
<pre class="src src-matlab">Jk<span class="org-type">'*</span>diag(ki)<span class="org-type">*</span>Jk
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">6</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">6</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">8</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">14</td>
<td class="org-right">4</td>
<td class="org-right">-2</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">4</td>
<td class="org-right">14</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">-2</td>
<td class="org-right">2</td>
<td class="org-right">12</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-type">figure</span>;
hold on;
<span class="org-type">set</span>(<span class="org-variable-name">gca</span>,<span class="org-string">'ColorOrderIndex'</span>,1)
plot(b1(1), b1(2), <span class="org-string">'o'</span>);
<span class="org-type">set</span>(<span class="org-variable-name">gca</span>,<span class="org-string">'ColorOrderIndex'</span>,2)
plot(b2(1), b2(2), <span class="org-string">'o'</span>);
<span class="org-type">set</span>(<span class="org-variable-name">gca</span>,<span class="org-string">'ColorOrderIndex'</span>,3)
plot(b3(1), b3(2), <span class="org-string">'o'</span>);
<span class="org-type">set</span>(<span class="org-variable-name">gca</span>,<span class="org-string">'ColorOrderIndex'</span>,1)
quiver(b1(1),b1(2),0.1<span class="org-type">*</span>s1(1),0.1<span class="org-type">*</span>s1(2))
<span class="org-type">set</span>(<span class="org-variable-name">gca</span>,<span class="org-string">'ColorOrderIndex'</span>,2)
quiver(b2(1),b2(2),0.1<span class="org-type">*</span>s2(1),0.1<span class="org-type">*</span>s2(2))
<span class="org-type">set</span>(<span class="org-variable-name">gca</span>,<span class="org-string">'ColorOrderIndex'</span>,3)
quiver(b3(1),b3(2),0.1<span class="org-type">*</span>s3(1),0.1<span class="org-type">*</span>s3(2))

plot(0, 0, <span class="org-string">'ko'</span>);
quiver([0,0],[0,0],[0.1,0],[0,0.1], <span class="org-string">'k'</span>)

plot(Ok(1), Ok(2), <span class="org-string">'ro'</span>);
quiver([Ok(1),Ok(1)],[Ok(2),Ok(2)],[0.1,0],[0,0.1], <span class="org-string">'r'</span>)

hold off;
<span class="org-type">axis</span> equal;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf6345a4" class="outline-3">
<h3 id="orgf6345a4"><span class="section-number-3">4.5</span> Example 2 - Stewart Platform</h3>
</div>
</div>
<div id="outline-container-org1c48f2d" class="outline-2">
<h2 id="org1c48f2d"><span class="section-number-2">5</span> Stiffness and Mass Matrices in the Leg&rsquo;s frame</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org876badc" class="outline-3">
<h3 id="org876badc"><span class="section-number-3">5.1</span> Equations</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Equations in the \(\{M\}\) frame:
</p>
\begin{equation}
\left( M_{\{M\}} s^2 + K_{\{M\}} \right) \mathcal{X}_{\{M\}} = \mathcal{F}_{\{M\}}
\end{equation}

<p>
Thank to the Jacobian, we can transform the equation of motion expressed in the \(\{M\}\) frame to the frame of the legs:
</p>
\begin{equation}
J_{\{M\}}^{-T} \left( M_{\{M\}} s^2 + K_{\{M\}} \right) J_{\{M\}}^{-1} \dot{\mathcal{L}} = \tau
\end{equation}

<p>
And we have new stiffness and mass matrices:
</p>
\begin{equation}
\left( M_{\{L\}} s^2 + K_{\{L\}} \right) \dot{\mathcal{L}} = \tau
\end{equation}
<p>
with:
</p>
<ul class="org-ul">
<li>The local mass matrix:
\[ M_{\{L\}} = J_{\{M\}}^{-T} M_{\{M\}} J_{\{M\}}^{-1} \]</li>
<li>The local stiffness matrix:
\[ K_{\{L\}} = J_{\{M\}}^{-T} K_{\{M\}} J_{\{M\}}^{-1} \]</li>
</ul>
</div>
</div>

<div id="outline-container-orgc2a4b8d" class="outline-3">
<h3 id="orgc2a4b8d"><span class="section-number-3">5.2</span> Stiffness matrix</h3>
<div class="outline-text-3" id="text-5-2">
<p>
We have that:
\[ K_{\{M\}} = J_{\{M\}}^T \mathcal{K} J_{\{M\}} \]
</p>

<p>
Therefore, we find that \(K_{\{L\}}\) is a diagonal matrix:
</p>
\begin{equation}
K_{\{L\}} = \mathcal{K} = \begin{bmatrix}
k_1 & & 0 \\
 & \ddots & \\
0 & & k_n
\end{bmatrix}
\end{equation}

<p>
The dynamics from \(\tau\) to \(\mathcal{L}\) is therefore decoupled at low frequency.
</p>
</div>
</div>

<div id="outline-container-org103d033" class="outline-3">
<h3 id="org103d033"><span class="section-number-3">5.3</span> Mass matrix</h3>
<div class="outline-text-3" id="text-5-3">
<p>
The mass matrix in the frames of the legs is:
\[ M_{\{L\}} = J_{\{M\}}^{-T} M_{\{M\}} J_{\{M\}}^{-1} \]
with \(M_{\{M\}}\) a diagonal matrix:
</p>
\begin{equation}
M_{\{M\}} = \begin{bmatrix}
m &   &   &     &     & \\
  & m &   &     & 0   & \\
  &   & m &     &     & \\
  &   &   & I_x &     & \\
  & 0 &   &     & I_y & \\
  &   &   &     &     & I_z
\end{bmatrix}
\end{equation}

<p>
Let&rsquo;s suppose \(M_{\{L\}} = \mathcal{M}\) diagonal and try to find what does this imply:
\[ M_{\{M\}} = J_{\{M\}}^{T} \mathcal{M} J_{\{M\}} \]
with:
</p>
\begin{equation}
\mathcal{M} = \begin{bmatrix}
m_1 & & 0 \\
 & \ddots & \\
0 & & m_n
\end{bmatrix}
\end{equation}

<p>
We obtain:
</p>
\begin{equation}
\boxed{
M_{\{M\}} = \left[ \begin{array}{c|c}
  m_i \hat{s}_i \hat{s}_i^T              & m_i \hat{s}_i (b_i \times \hat{s}_i)^T \cr
  \hline
  k_i \hat{s}_i (b_i \times \hat{s}_i)^T & m_i (b_i \times \hat{s}_i) (b_i \times \hat{s}_i)^T
\end{array} \right]
}
\end{equation}

<p>
Therefore, we have the following conditions:
</p>
\begin{align}
m_i \hat{s}_i \hat{s}_i^T &= m \bm{I}_{3} \\
m_i \hat{s}_i (b_i \times \hat{s}_i)^T &= \bm{O}_{3} \\
m_i (b_i \times \hat{s}_i) (b_i \times \hat{s}_i)^T &= \text{diag}(I_x, I_y, I_z)
\end{align}
</div>
</div>


<div id="outline-container-orgbc3dbc5" class="outline-3">
<h3 id="orgbc3dbc5"><span class="section-number-3">5.4</span> Planar Example</h3>
<div class="outline-text-3" id="text-5-4">
<p>
The stiffnesses \(k_i\), the joint positions \({}^Mb_i\) and joint unit vectors \({}^M\hat{s}_i\) are defined below:
</p>
<div class="org-src-container">
<pre class="src src-matlab">ki = [1,1,1]; <span class="org-comment">% Stiffnesses [N/m]</span>
si = [[1;0],[0;1],[0;1]]; si = si<span class="org-type">./</span>vecnorm(si); <span class="org-comment">% Unit Vectors</span>
bi = [[<span class="org-type">-</span>1; 0],[<span class="org-type">-</span>10;<span class="org-type">-</span>1],[0;<span class="org-type">-</span>1]]; <span class="org-comment">% Joint's positions in frame {M}</span>
</pre>
</div>

<p>
Jacobian in frame \(\{M\}\):
</p>
<div class="org-src-container">
<pre class="src src-matlab">Jm = [si<span class="org-type">'</span>, (bi(1,<span class="org-type">:</span>)<span class="org-type">.*</span>si(2,<span class="org-type">:</span>) <span class="org-type">-</span> bi(2,<span class="org-type">:</span>)<span class="org-type">.*</span>si(1,<span class="org-type">:</span>))<span class="org-type">'</span>];
</pre>
</div>

<p>
And the stiffness matrix in frame \(\{K\}\):
</p>
<div class="org-src-container">
<pre class="src src-matlab">Km = Jm<span class="org-type">'*</span>diag(ki)<span class="org-type">*</span>Jm;
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">-1</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">-1</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>

<p>
Mass matrix in the frame \(\{M\}\):
</p>
<div class="org-src-container">
<pre class="src src-matlab">m = 10; <span class="org-comment">% [kg]</span>
I = 1; <span class="org-comment">% [kg.m^2]</span>

Mm = diag([m, m, I]);
</pre>
</div>


<p>
Now compute \(K\) and \(M\) in the frame of the legs:
</p>
<div class="org-src-container">
<pre class="src src-matlab">ML = inv(Jm)<span class="org-type">'*</span>Mm<span class="org-type">*</span>inv(Jm)
KL = inv(Jm)<span class="org-type">'*</span>Km<span class="org-type">*</span>inv(Jm)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">Gm = 1<span class="org-type">/</span>(ML<span class="org-type">*</span>s<span class="org-type">^</span>2 <span class="org-type">+</span> KL);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">freqs = logspace(<span class="org-type">-</span>2, 1, 1000);
<span class="org-type">figure</span>;
hold on;
<span class="org-keyword">for</span> <span class="org-variable-name"><span class="org-constant">i</span></span> = <span class="org-constant">1:length(ki)</span>
    plot(freqs, abs(squeeze(freqresp(Gm(<span class="org-constant">i</span>,<span class="org-constant">i</span>), freqs, <span class="org-string">'Hz'</span>))), <span class="org-string">'k-'</span>)
<span class="org-keyword">end</span>
<span class="org-keyword">for</span> <span class="org-variable-name"><span class="org-constant">i</span></span> = <span class="org-constant">1:length(ki)</span>
    <span class="org-keyword">for</span> <span class="org-variable-name"><span class="org-constant">j</span></span> = <span class="org-constant"><span class="org-constant">i</span></span><span class="org-constant">+1:length(ki)</span>
        plot(freqs, abs(squeeze(freqresp(Gm(<span class="org-constant">i</span>,<span class="org-constant">j</span>), freqs, <span class="org-string">'Hz'</span>))), <span class="org-string">'r-'</span>)
    <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
hold off;
xlabel(<span class="org-string">'Frequency [Hz]'</span>);
ylabel(<span class="org-string">'Magnitude'</span>);
<span class="org-type">set</span>(<span class="org-variable-name">gca</span>, <span class="org-string">'xscale'</span>, <span class="org-string">'log'</span>);
<span class="org-type">set</span>(<span class="org-variable-name">gca</span>, <span class="org-string">'yscale'</span>, <span class="org-string">'log'</span>);
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2a7399f" class="outline-2">
<h2 id="org2a7399f"><span class="section-number-2">6</span> Stewart Platform - Simscape Model</h2>
<div class="outline-text-2" id="text-6">
<p>
<a id="org739fa10"></a>
</p>
<p>
In this analysis, we wish to applied SVD control to the Stewart Platform shown in Figure <a href="#orgd41abd5">40</a>.
</p>

<p>
Some notes about the system:
</p>
<ul class="org-ul">
<li>6 voice coils actuators are used to control the motion of the top platform.</li>
<li>the motion of the top platform is measured with a 6-axis inertial unit (3 acceleration + 3 angular accelerations)</li>
<li>the control objective is to isolate the top platform from vibrations coming from the bottom platform</li>
</ul>


<div id="orgd41abd5" class="figure">
<p><img src="figs/SP_assembly.png" alt="SP_assembly.png" />
</p>
<p><span class="figure-number">Figure 40: </span>Stewart Platform CAD View</p>
</div>

<p>
The analysis of the SVD/Jacobian control applied to the Stewart platform is performed in the following sections:
</p>
<ul class="org-ul">
<li>Section <a href="#org33a5091">6.1</a>: The parameters of the Simscape model of the Stewart platform are defined</li>
<li>Section <a href="#org05fd81b">6.2</a>: The plant is identified from the Simscape model and the system coupling is shown</li>
<li>Section <a href="#org5162477">6.3</a>: The plant is first decoupled using the Jacobian</li>
<li>Section <a href="#org57d4713">6.4</a>: The decoupling is performed thanks to the SVD. To do so a real approximation of the plant is computed.</li>
<li>Section <a href="#org31946c0">6.5</a>: The effectiveness of the decoupling with the Jacobian and SVD are compared using the Gershorin Radii</li>
<li>Section <a href="#orge691d2f">6.6</a>:</li>
<li>Section <a href="#orgdc54c79">6.7</a>: The dynamics of the decoupled plants are shown</li>
<li>Section <a href="#org999b548">6.8</a>: A diagonal controller is defined to control the decoupled plant</li>
<li>Section <a href="#org0e9b941">6.9</a>: Finally, the closed loop system properties are studied</li>
</ul>
</div>

<div id="outline-container-orga3861da" class="outline-3">
<h3 id="orga3861da"><span class="section-number-3">6.1</span> Simscape Model - Parameters</h3>
<div class="outline-text-3" id="text-6-1">
<p>
<a id="org33a5091"></a>
</p>
<div class="org-src-container">
<pre class="src src-matlab">open(<span class="org-string">'drone_platform.slx'</span>);
</pre>
</div>

<p>
Definition of spring parameters:
</p>
<div class="org-src-container">
<pre class="src src-matlab">kx = 0.5<span class="org-type">*</span>1e3<span class="org-type">/</span>3; <span class="org-comment">% [N/m]</span>
ky = 0.5<span class="org-type">*</span>1e3<span class="org-type">/</span>3;
kz = 1e3<span class="org-type">/</span>3;

cx = 0.025; <span class="org-comment">% [Nm/rad]</span>
cy = 0.025;
cz = 0.025;
</pre>
</div>

<p>
We suppose the sensor is perfectly positioned.
</p>
<div class="org-src-container">
<pre class="src src-matlab">sens_pos_error = zeros(3,1);
</pre>
</div>

<p>
Gravity:
</p>
<div class="org-src-container">
<pre class="src src-matlab">g = 0;
</pre>
</div>

<p>
We load the Jacobian (previously computed from the geometry):
</p>
<div class="org-src-container">
<pre class="src src-matlab">load(<span class="org-string">'jacobian.mat'</span>, <span class="org-string">'Aa'</span>, <span class="org-string">'Ab'</span>, <span class="org-string">'As'</span>, <span class="org-string">'l'</span>, <span class="org-string">'J'</span>);
</pre>
</div>

<p>
We initialize other parameters:
</p>
<div class="org-src-container">
<pre class="src src-matlab">U = eye(6);
V = eye(6);
Kc = tf(zeros(6));
</pre>
</div>


<div id="orgce34ca5" class="figure">
<p><img src="figs/stewart_simscape.png" alt="stewart_simscape.png" />
</p>
<p><span class="figure-number">Figure 41: </span>General view of the Simscape Model</p>
</div>


<div id="org65275b4" class="figure">
<p><img src="figs/stewart_platform_details.png" alt="stewart_platform_details.png" />
</p>
<p><span class="figure-number">Figure 42: </span>Simscape model of the Stewart platform</p>
</div>
</div>
</div>

<div id="outline-container-orgc4e5701" class="outline-3">
<h3 id="orgc4e5701"><span class="section-number-3">6.2</span> Identification of the plant</h3>
<div class="outline-text-3" id="text-6-2">
<p>
<a id="org05fd81b"></a>
</p>

<p>
The plant shown in Figure <a href="#org03c7330">43</a> is identified from the Simscape model.
</p>

<p>
The inputs are:
</p>
<ul class="org-ul">
<li>\(D_w\) translation and rotation of the bottom platform (with respect to the center of mass of the top platform)</li>
<li>\(\tau\) the 6 forces applied by the voice coils</li>
</ul>

<p>
The outputs are the 6 accelerations measured by the inertial unit.
</p>


<div id="org03c7330" class="figure">
<p><img src="figs/stewart_platform_plant.png" alt="stewart_platform_plant.png" />
</p>
<p><span class="figure-number">Figure 43: </span>Considered plant \(\bm{G} = \begin{bmatrix}G_d\\G_u\end{bmatrix}\). \(D_w\) is the translation/rotation of the support, \(\tau\) the actuator forces, \(a\) the acceleration/angular acceleration of the top platform</p>
</div>

<div class="org-src-container">
<pre class="src src-matlab"><span class="org-matlab-cellbreak"><span class="org-comment">%% Name of the Simulink File</span></span>
mdl = <span class="org-string">'drone_platform'</span>;

<span class="org-matlab-cellbreak"><span class="org-comment">%% Input/Output definition</span></span>
clear io; io_i = 1;
io(io_i) = linio([mdl, <span class="org-string">'/Dw'</span>],              1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1; <span class="org-comment">% Ground Motion</span>
io(io_i) = linio([mdl, <span class="org-string">'/V-T'</span>],             1, <span class="org-string">'openinput'</span>);  io_i = io_i <span class="org-type">+</span> 1; <span class="org-comment">% Actuator Forces</span>
io(io_i) = linio([mdl, <span class="org-string">'/Inertial Sensor'</span>], 1, <span class="org-string">'openoutput'</span>); io_i = io_i <span class="org-type">+</span> 1; <span class="org-comment">% Top platform acceleration</span>

G = linearize(mdl, io);
G.InputName  = {<span class="org-string">'Dwx'</span>, <span class="org-string">'Dwy'</span>, <span class="org-string">'Dwz'</span>, <span class="org-string">'Rwx'</span>, <span class="org-string">'Rwy'</span>, <span class="org-string">'Rwz'</span>, ...
                <span class="org-string">'F1'</span>, <span class="org-string">'F2'</span>, <span class="org-string">'F3'</span>, <span class="org-string">'F4'</span>, <span class="org-string">'F5'</span>, <span class="org-string">'F6'</span>};
G.OutputName = {<span class="org-string">'Ax'</span>, <span class="org-string">'Ay'</span>, <span class="org-string">'Az'</span>, <span class="org-string">'Arx'</span>, <span class="org-string">'Ary'</span>, <span class="org-string">'Arz'</span>};

<span class="org-comment">% Plant</span>
Gu = G(<span class="org-type">:</span>, {<span class="org-string">'F1'</span>, <span class="org-string">'F2'</span>, <span class="org-string">'F3'</span>, <span class="org-string">'F4'</span>, <span class="org-string">'F5'</span>, <span class="org-string">'F6'</span>});
<span class="org-comment">% Disturbance dynamics</span>
Gd = G(<span class="org-type">:</span>, {<span class="org-string">'Dwx'</span>, <span class="org-string">'Dwy'</span>, <span class="org-string">'Dwz'</span>, <span class="org-string">'Rwx'</span>, <span class="org-string">'Rwy'</span>, <span class="org-string">'Rwz'</span>});
</pre>
</div>

<p>
There are 24 states (6dof for the bottom platform + 6dof for the top platform).
</p>
<div class="org-src-container">
<pre class="src src-matlab">size(G)
</pre>
</div>

<pre class="example">
State-space model with 6 outputs, 12 inputs, and 24 states.
</pre>


<p>
The elements of the transfer matrix \(\bm{G}\) corresponding to the transfer function from actuator forces \(\tau\) to the measured acceleration \(a\) are shown in Figure <a href="#org18ca8e9">44</a>.
</p>

<p>
One can easily see that the system is strongly coupled.
</p>


<div id="org18ca8e9" class="figure">
<p><img src="figs/stewart_platform_coupled_plant.png" alt="stewart_platform_coupled_plant.png" />
</p>
<p><span class="figure-number">Figure 44: </span>Magnitude of all 36 elements of the transfer function matrix \(G_u\)</p>
</div>
</div>
</div>

<div id="outline-container-org4a98b83" class="outline-3">
<h3 id="org4a98b83"><span class="section-number-3">6.3</span> Decoupling using the Jacobian</h3>
<div class="outline-text-3" id="text-6-3">
<p>
<a id="org5162477"></a>
Consider the control architecture shown in Figure <a href="#org6e3359c">45</a>.
The Jacobian matrix is used to transform forces/torques applied on the top platform to the equivalent forces applied by each actuator.
</p>

<p>
The Jacobian matrix is computed from the geometry of the platform (position and orientation of the actuators).
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 12:</span> Computed Jacobian Matrix</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">0.811</td>
<td class="org-right">0.0</td>
<td class="org-right">0.584</td>
<td class="org-right">-0.018</td>
<td class="org-right">-0.008</td>
<td class="org-right">0.025</td>
</tr>

<tr>
<td class="org-right">-0.406</td>
<td class="org-right">-0.703</td>
<td class="org-right">0.584</td>
<td class="org-right">-0.016</td>
<td class="org-right">-0.012</td>
<td class="org-right">-0.025</td>
</tr>

<tr>
<td class="org-right">-0.406</td>
<td class="org-right">0.703</td>
<td class="org-right">0.584</td>
<td class="org-right">0.016</td>
<td class="org-right">-0.012</td>
<td class="org-right">0.025</td>
</tr>

<tr>
<td class="org-right">0.811</td>
<td class="org-right">0.0</td>
<td class="org-right">0.584</td>
<td class="org-right">0.018</td>
<td class="org-right">-0.008</td>
<td class="org-right">-0.025</td>
</tr>

<tr>
<td class="org-right">-0.406</td>
<td class="org-right">-0.703</td>
<td class="org-right">0.584</td>
<td class="org-right">0.002</td>
<td class="org-right">0.019</td>
<td class="org-right">0.025</td>
</tr>

<tr>
<td class="org-right">-0.406</td>
<td class="org-right">0.703</td>
<td class="org-right">0.584</td>
<td class="org-right">-0.002</td>
<td class="org-right">0.019</td>
<td class="org-right">-0.025</td>
</tr>
</tbody>
</table>


<div id="org6e3359c" class="figure">
<p><img src="figs/plant_decouple_jacobian.png" alt="plant_decouple_jacobian.png" />
</p>
<p><span class="figure-number">Figure 45: </span>Decoupled plant \(\bm{G}_x\) using the Jacobian matrix \(J\)</p>
</div>

<p>
We define a new plant:
\[ G_x(s) = G(s) J^{-T} \]
</p>

<p>
\(G_x(s)\) correspond to the transfer function from forces and torques applied to the top platform to the absolute acceleration of the top platform.
</p>

<div class="org-src-container">
<pre class="src src-matlab">Gx = Gu<span class="org-type">*</span>inv(J<span class="org-type">'</span>);
Gx.InputName  = {<span class="org-string">'Fx'</span>, <span class="org-string">'Fy'</span>, <span class="org-string">'Fz'</span>, <span class="org-string">'Mx'</span>, <span class="org-string">'My'</span>, <span class="org-string">'Mz'</span>};
</pre>
</div>
</div>
</div>

<div id="outline-container-org05f169b" class="outline-3">
<h3 id="org05f169b"><span class="section-number-3">6.4</span> Decoupling using the SVD</h3>
<div class="outline-text-3" id="text-6-4">
<p>
<a id="org57d4713"></a>
</p>

<p>
In order to decouple the plant using the SVD, first a real approximation of the plant transfer function matrix as the crossover frequency is required.
</p>

<p>
Let&rsquo;s compute a real approximation of the complex matrix \(H_1\) which corresponds to the the transfer function \(G_u(j\omega_c)\) from forces applied by the actuators to the measured acceleration of the top platform evaluated at the frequency \(\omega_c\).
</p>
<div class="org-src-container">
<pre class="src src-matlab">wc = 2<span class="org-type">*</span><span class="org-constant">pi</span><span class="org-type">*</span>30; <span class="org-comment">% Decoupling frequency [rad/s]</span>

H1 = evalfr(Gu, <span class="org-constant">j</span><span class="org-type">*</span>wc);
</pre>
</div>

<p>
The real approximation is computed as follows:
</p>
<div class="org-src-container">
<pre class="src src-matlab">D = pinv(real(H1<span class="org-type">'*</span>H1));
H1 = inv(D<span class="org-type">*</span>real(H1<span class="org-type">'*</span>diag(exp(<span class="org-constant">j</span><span class="org-type">*</span>angle(diag(H1<span class="org-type">*</span>D<span class="org-type">*</span>H1<span class="org-type">.'</span>))<span class="org-type">/</span>2))));
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 13:</span> Real approximate of \(G\) at the decoupling frequency \(\omega_c\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">4.4</td>
<td class="org-right">-2.1</td>
<td class="org-right">-2.1</td>
<td class="org-right">4.4</td>
<td class="org-right">-2.4</td>
<td class="org-right">-2.4</td>
</tr>

<tr>
<td class="org-right">-0.2</td>
<td class="org-right">-3.9</td>
<td class="org-right">3.9</td>
<td class="org-right">0.2</td>
<td class="org-right">-3.8</td>
<td class="org-right">3.8</td>
</tr>

<tr>
<td class="org-right">3.4</td>
<td class="org-right">3.4</td>
<td class="org-right">3.4</td>
<td class="org-right">3.4</td>
<td class="org-right">3.4</td>
<td class="org-right">3.4</td>
</tr>

<tr>
<td class="org-right">-367.1</td>
<td class="org-right">-323.8</td>
<td class="org-right">323.8</td>
<td class="org-right">367.1</td>
<td class="org-right">43.3</td>
<td class="org-right">-43.3</td>
</tr>

<tr>
<td class="org-right">-162.0</td>
<td class="org-right">-237.0</td>
<td class="org-right">-237.0</td>
<td class="org-right">-162.0</td>
<td class="org-right">398.9</td>
<td class="org-right">398.9</td>
</tr>

<tr>
<td class="org-right">220.6</td>
<td class="org-right">-220.6</td>
<td class="org-right">220.6</td>
<td class="org-right">-220.6</td>
<td class="org-right">220.6</td>
<td class="org-right">-220.6</td>
</tr>
</tbody>
</table>


<p>
Note that the plant \(G_u\) at \(\omega_c\) is already an almost real matrix.
This can be seen on the Bode plots where the phase is close to 1.
This can be verified below where only the real value of \(G_u(\omega_c)\) is shown
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 14:</span> Real part of \(G\) at the decoupling frequency \(\omega_c\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">4.4</td>
<td class="org-right">-2.1</td>
<td class="org-right">-2.1</td>
<td class="org-right">4.4</td>
<td class="org-right">-2.4</td>
<td class="org-right">-2.4</td>
</tr>

<tr>
<td class="org-right">-0.2</td>
<td class="org-right">-3.9</td>
<td class="org-right">3.9</td>
<td class="org-right">0.2</td>
<td class="org-right">-3.8</td>
<td class="org-right">3.8</td>
</tr>

<tr>
<td class="org-right">3.4</td>
<td class="org-right">3.4</td>
<td class="org-right">3.4</td>
<td class="org-right">3.4</td>
<td class="org-right">3.4</td>
<td class="org-right">3.4</td>
</tr>

<tr>
<td class="org-right">-367.1</td>
<td class="org-right">-323.8</td>
<td class="org-right">323.8</td>
<td class="org-right">367.1</td>
<td class="org-right">43.3</td>
<td class="org-right">-43.3</td>
</tr>

<tr>
<td class="org-right">-162.0</td>
<td class="org-right">-237.0</td>
<td class="org-right">-237.0</td>
<td class="org-right">-162.0</td>
<td class="org-right">398.9</td>
<td class="org-right">398.9</td>
</tr>

<tr>
<td class="org-right">220.6</td>
<td class="org-right">-220.6</td>
<td class="org-right">220.6</td>
<td class="org-right">-220.6</td>
<td class="org-right">220.6</td>
<td class="org-right">-220.6</td>
</tr>
</tbody>
</table>

<p>
Now, the Singular Value Decomposition of \(H_1\) is performed:
\[ H_1 = U \Sigma V^H \]
</p>

<div class="org-src-container">
<pre class="src src-matlab">[U,<span class="org-type">~</span>,V] = svd(H1);
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 15:</span> Obtained matrix \(U\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">-0.005</td>
<td class="org-right">7e-06</td>
<td class="org-right">6e-11</td>
<td class="org-right">-3e-06</td>
<td class="org-right">-1</td>
<td class="org-right">0.1</td>
</tr>

<tr>
<td class="org-right">-7e-06</td>
<td class="org-right">-0.005</td>
<td class="org-right">-9e-09</td>
<td class="org-right">-5e-09</td>
<td class="org-right">-0.1</td>
<td class="org-right">-1</td>
</tr>

<tr>
<td class="org-right">4e-08</td>
<td class="org-right">-2e-10</td>
<td class="org-right">-6e-11</td>
<td class="org-right">-1</td>
<td class="org-right">3e-06</td>
<td class="org-right">-3e-07</td>
</tr>

<tr>
<td class="org-right">-0.002</td>
<td class="org-right">-1</td>
<td class="org-right">-5e-06</td>
<td class="org-right">2e-10</td>
<td class="org-right">0.0006</td>
<td class="org-right">0.005</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">-0.002</td>
<td class="org-right">-1e-08</td>
<td class="org-right">2e-08</td>
<td class="org-right">-0.005</td>
<td class="org-right">0.0006</td>
</tr>

<tr>
<td class="org-right">-4e-09</td>
<td class="org-right">5e-06</td>
<td class="org-right">-1</td>
<td class="org-right">6e-11</td>
<td class="org-right">-2e-09</td>
<td class="org-right">-1e-08</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 16:</span> Obtained matrix \(V\)</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">-0.2</td>
<td class="org-right">0.5</td>
<td class="org-right">-0.4</td>
<td class="org-right">-0.4</td>
<td class="org-right">-0.6</td>
<td class="org-right">-0.2</td>
</tr>

<tr>
<td class="org-right">-0.3</td>
<td class="org-right">0.5</td>
<td class="org-right">0.4</td>
<td class="org-right">-0.4</td>
<td class="org-right">0.5</td>
<td class="org-right">0.3</td>
</tr>

<tr>
<td class="org-right">-0.3</td>
<td class="org-right">-0.5</td>
<td class="org-right">-0.4</td>
<td class="org-right">-0.4</td>
<td class="org-right">0.4</td>
<td class="org-right">-0.4</td>
</tr>

<tr>
<td class="org-right">-0.2</td>
<td class="org-right">-0.5</td>
<td class="org-right">0.4</td>
<td class="org-right">-0.4</td>
<td class="org-right">-0.5</td>
<td class="org-right">0.3</td>
</tr>

<tr>
<td class="org-right">0.6</td>
<td class="org-right">-0.06</td>
<td class="org-right">-0.4</td>
<td class="org-right">-0.4</td>
<td class="org-right">0.1</td>
<td class="org-right">0.6</td>
</tr>

<tr>
<td class="org-right">0.6</td>
<td class="org-right">0.06</td>
<td class="org-right">0.4</td>
<td class="org-right">-0.4</td>
<td class="org-right">-0.006</td>
<td class="org-right">-0.6</td>
</tr>
</tbody>
</table>

<p>
The obtained matrices \(U\) and \(V\) are used to decouple the system as shown in Figure <a href="#orgacfec1d">46</a>.
</p>


<div id="orgacfec1d" class="figure">
<p><img src="figs/plant_decouple_svd.png" alt="plant_decouple_svd.png" />
</p>
<p><span class="figure-number">Figure 46: </span>Decoupled plant \(\bm{G}_{SVD}\) using the Singular Value Decomposition</p>
</div>

<p>
The decoupled plant is then:
\[ G_{SVD}(s) = U^{-1} G_u(s) V^{-H} \]
</p>

<div class="org-src-container">
<pre class="src src-matlab">Gsvd = inv(U)<span class="org-type">*</span>Gu<span class="org-type">*</span>inv(V<span class="org-type">'</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-org1cbd2c1" class="outline-3">
<h3 id="org1cbd2c1"><span class="section-number-3">6.5</span> Verification of the decoupling using the &ldquo;Gershgorin Radii&rdquo;</h3>
<div class="outline-text-3" id="text-6-5">
<p>
<a id="org31946c0"></a>
</p>

<p>
The &ldquo;Gershgorin Radii&rdquo; is computed for the coupled plant \(G(s)\), for the &ldquo;Jacobian plant&rdquo; \(G_x(s)\) and the &ldquo;SVD Decoupled Plant&rdquo; \(G_{SVD}(s)\):
</p>

<p>
The &ldquo;Gershgorin Radii&rdquo; of a matrix \(S\) is defined by:
\[ \zeta_i(j\omega) = \frac{\sum\limits_{j\neq i}|S_{ij}(j\omega)|}{|S_{ii}(j\omega)|} \]
</p>

<p>
This is computed over the following frequencies.
</p>

<div id="org68d310b" class="figure">
<p><img src="figs/simscape_model_gershgorin_radii.png" alt="simscape_model_gershgorin_radii.png" />
</p>
<p><span class="figure-number">Figure 47: </span>Gershgorin Radii of the Coupled and Decoupled plants</p>
</div>
</div>
</div>

<div id="outline-container-org18efe55" class="outline-3">
<h3 id="org18efe55"><span class="section-number-3">6.6</span> Verification of the decoupling using the &ldquo;Relative Gain Array&rdquo;</h3>
<div class="outline-text-3" id="text-6-6">
<p>
<a id="orge691d2f"></a>
</p>

<p>
The relative gain array (RGA) is defined as:
</p>
\begin{equation}
  \Lambda\big(G(s)\big) = G(s) \times \big( G(s)^{-1} \big)^T
\end{equation}
<p>
where \(\times\) denotes an element by element multiplication and \(G(s)\) is an \(n \times n\) square transfer matrix.
</p>

<p>
The obtained RGA elements are shown in Figure <a href="#org2d63511">48</a>.
</p>


<div id="org2d63511" class="figure">
<p><img src="figs/simscape_model_rga.png" alt="simscape_model_rga.png" />
</p>
<p><span class="figure-number">Figure 48: </span>Obtained norm of RGA elements for the SVD decoupled plant and the Jacobian decoupled plant</p>
</div>
</div>
</div>

<div id="outline-container-orgadea7b0" class="outline-3">
<h3 id="orgadea7b0"><span class="section-number-3">6.7</span> Obtained Decoupled Plants</h3>
<div class="outline-text-3" id="text-6-7">
<p>
<a id="orgdc54c79"></a>
</p>

<p>
The bode plot of the diagonal and off-diagonal elements of \(G_{SVD}\) are shown in Figure <a href="#org8713f90">49</a>.
</p>


<div id="org8713f90" class="figure">
<p><img src="figs/simscape_model_decoupled_plant_svd.png" alt="simscape_model_decoupled_plant_svd.png" />
</p>
<p><span class="figure-number">Figure 49: </span>Decoupled Plant using SVD</p>
</div>

<p>
Similarly, the bode plots of the diagonal elements and off-diagonal elements of the decoupled plant \(G_x(s)\) using the Jacobian are shown in Figure <a href="#orgbc6a017">50</a>.
</p>


<div id="orgbc6a017" class="figure">
<p><img src="figs/simscape_model_decoupled_plant_jacobian.png" alt="simscape_model_decoupled_plant_jacobian.png" />
</p>
<p><span class="figure-number">Figure 50: </span>Stewart Platform Plant from forces (resp. torques) applied by the legs to the acceleration (resp. angular acceleration) of the platform as well as all the coupling terms between the two (non-diagonal terms of the transfer function matrix)</p>
</div>
</div>
</div>

<div id="outline-container-orgc208a81" class="outline-3">
<h3 id="orgc208a81"><span class="section-number-3">6.8</span> Diagonal Controller</h3>
<div class="outline-text-3" id="text-6-8">
<p>
<a id="org999b548"></a>
The control diagram for the centralized control is shown in Figure <a href="#orgc454dcb">51</a>.
</p>

<p>
The controller \(K_c\) is &ldquo;working&rdquo; in an cartesian frame.
The Jacobian is used to convert forces in the cartesian frame to forces applied by the actuators.
</p>


<div id="orgc454dcb" class="figure">
<p><img src="figs/centralized_control.png" alt="centralized_control.png" />
</p>
<p><span class="figure-number">Figure 51: </span>Control Diagram for the Centralized control</p>
</div>

<p>
The SVD control architecture is shown in Figure <a href="#orga180db4">52</a>.
The matrices \(U\) and \(V\) are used to decoupled the plant \(G\).
</p>


<div id="orga180db4" class="figure">
<p><img src="figs/svd_control.png" alt="svd_control.png" />
</p>
<p><span class="figure-number">Figure 52: </span>Control Diagram for the SVD control</p>
</div>


<p>
We choose the controller to be a low pass filter:
\[ K_c(s) = \frac{G_0}{1 + \frac{s}{\omega_0}} \]
</p>

<p>
\(G_0\) is tuned such that the crossover frequency corresponding to the diagonal terms of the loop gain is equal to \(\omega_c\)
</p>

<div class="org-src-container">
<pre class="src src-matlab">wc = 2<span class="org-type">*</span><span class="org-constant">pi</span><span class="org-type">*</span>80;  <span class="org-comment">% Crossover Frequency [rad/s]</span>
w0 = 2<span class="org-type">*</span><span class="org-constant">pi</span><span class="org-type">*</span>0.1; <span class="org-comment">% Controller Pole [rad/s]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">K_cen = diag(1<span class="org-type">./</span>diag(abs(evalfr(Gx, <span class="org-constant">j</span><span class="org-type">*</span>wc))))<span class="org-type">*</span>(1<span class="org-type">/</span>abs(evalfr(1<span class="org-type">/</span>(1 <span class="org-type">+</span> s<span class="org-type">/</span>w0), <span class="org-constant">j</span><span class="org-type">*</span>wc)))<span class="org-type">/</span>(1 <span class="org-type">+</span> s<span class="org-type">/</span>w0);
L_cen = K_cen<span class="org-type">*</span>Gx;
G_cen = feedback(G, pinv(J<span class="org-type">'</span>)<span class="org-type">*</span>K_cen, [7<span class="org-type">:</span>12], [1<span class="org-type">:</span>6]);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">K_svd = diag(1<span class="org-type">./</span>diag(abs(evalfr(Gsvd, <span class="org-constant">j</span><span class="org-type">*</span>wc))))<span class="org-type">*</span>(1<span class="org-type">/</span>abs(evalfr(1<span class="org-type">/</span>(1 <span class="org-type">+</span> s<span class="org-type">/</span>w0), <span class="org-constant">j</span><span class="org-type">*</span>wc)))<span class="org-type">/</span>(1 <span class="org-type">+</span> s<span class="org-type">/</span>w0);
L_svd = K_svd<span class="org-type">*</span>Gsvd;
G_svd = feedback(G, inv(V<span class="org-type">'</span>)<span class="org-type">*</span>K_svd<span class="org-type">*</span>inv(U), [7<span class="org-type">:</span>12], [1<span class="org-type">:</span>6]);
</pre>
</div>

<p>
The obtained diagonal elements of the loop gains are shown in Figure <a href="#orgd6e7f60">53</a>.
</p>


<div id="orgd6e7f60" class="figure">
<p><img src="figs/stewart_comp_loop_gain_diagonal.png" alt="stewart_comp_loop_gain_diagonal.png" />
</p>
<p><span class="figure-number">Figure 53: </span>Comparison of the diagonal elements of the loop gains for the SVD control architecture and the Jacobian one</p>
</div>
</div>
</div>

<div id="outline-container-org0759f51" class="outline-3">
<h3 id="org0759f51"><span class="section-number-3">6.9</span> Closed-Loop system Performances</h3>
<div class="outline-text-3" id="text-6-9">
<p>
<a id="org0e9b941"></a>
</p>

<p>
Let&rsquo;s first verify the stability of the closed-loop systems:
</p>
<div class="org-src-container">
<pre class="src src-matlab">isstable(G_cen)
</pre>
</div>

<pre class="example">
ans =
  logical
   1
</pre>


<div class="org-src-container">
<pre class="src src-matlab">isstable(G_svd)
</pre>
</div>

<pre class="example">
ans =
  logical
   1
</pre>


<p>
The obtained transmissibility in Open-loop, for the centralized control as well as for the SVD control are shown in Figure <a href="#org6a6c331">54</a>.
</p>


<div id="org6a6c331" class="figure">
<p><img src="figs/stewart_platform_simscape_cl_transmissibility.png" alt="stewart_platform_simscape_cl_transmissibility.png" />
</p>
<p><span class="figure-number">Figure 54: </span>Obtained Transmissibility</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Dehaeze Thomas</p>
<p class="date">Created: 2021-02-17 mer. 15:15</p>
</div>
</body>
</html>
